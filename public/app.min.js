(function () {
    'use strict';

    var app = angular.module('app', [
        // Predefined modules.
        'ui.bootstrap',
        'ui.router',
        'ngResource',
        'ngRoute',

        // App components.
        'app.home',
        'app.recipes',

        // Admin components.
        'app.admin',
        'app.profile',
        'app.signUp',

        // App shared.
        'app.providers',
        'app.services',
        'app.resources'
    ]);
})();
(function () {
    'use strict';

    angular.module('app.admin', [

    ]);

})();
(function () {
    'use strict';

    angular.module('app.home', [

    ]);

})();
(function () {
    'use strict';

    angular.module('app.profile', [

    ]);

})();
(function () {
    'use strict';

    angular.module('app.recipes', [

    ]);

})();
(function () {
    'use strict';

    angular.module('app.signUp', [

    ]);

})();
(function () {
    'use strict';

    angular.module('app.providers', []);

})();
(function () {
    'use strict';

    angular.module('app.resources', []);

})();
(function () {
    'use strict';

    angular.module('app.services', []);

})();
(function () {
    'use strict';

    var app = angular.module('app');

    app.config(Configuration);

    Configuration.$inject = ['$logProvider', '$stateProvider', '$urlRouterProvider', '$locationProvider'];

    function Configuration($logProvider, $stateProvider, $urlRouterProvider, $locationProvider) {
        // Logging.
        $logProvider.debugEnabled(true);

        // HTML5 mode.
        $locationProvider.html5Mode({
            enabled: true,
            requireBase: false
        });

        // Always default to home page.
        $urlRouterProvider.otherwise('/app/home');

        // Routes.
        var defaultCtrlAs = 'vm';
        var mainViewsObj = {
            nav: {
                templateUrl: '/partials/layout/navTmpl',
                controller: 'NavCtrl',
                controllerAs: defaultCtrlAs
            },
            '': {
                templateUrl: '/partials/layout/contentTmpl',
                controller: 'ContentCtrl',
                controllerAs: defaultCtrlAs
            },
            sidebar: {
                templateUrl: '/partials/layout/sidebarTmpl',
                controller: 'SidebarCtrl',
                controllerAs: defaultCtrlAs
            },
            footer: {
                templateUrl: '/partials/layout/footerTmpl',
                controller: 'FooterCtrl',
                controllerAs: defaultCtrlAs
            }
        };

        $stateProvider
            .state('app', {
                abstract: true,
                url: '/app',
                views: mainViewsObj
            });
    }

    // Add extra properties to each state.
    app.run(['$rootScope', function ($rootScope) {
        $rootScope.$on('$stateChangeSuccess', function (event, current) {
            $rootScope.title = current.title;
            $rootScope.bodyCss = current.bodyCss;
        });
    }]);

})();
(function () {
    'use strict';

    var appAdmin = angular.module('app.admin');

    //=========================================================================
    // Config.
    //=========================================================================
    appAdmin.config(Configuration);

    Configuration.$inject = ['$stateProvider'];

    function Configuration($stateProvider) {
        var routeRoleChecks = {
            admin: {
                auth: function (authService) {
                    return authService.authorizeCurrentUserForRoute('admin');
                }
            }
        };

        $stateProvider
            .state('app.userList', {
                url: '/user-list',
                templateUrl: '/partials/components/admin/userListView',
                controller: 'UserListCtrl',
                controllerAs: 'vm',
                resolve: routeRoleChecks.admin,
                title: 'User List',
                bodyCss: 'user-list'
            });
    }

    //=========================================================================
    // Run.
    //=========================================================================
    appAdmin.run(Run);

    Run.$inject = ['$rootScope', '$state'];

    function Run($rootScope, $state) {
        $rootScope.$on('$stateChangeError', function (event, toState, toParams, fromState, fromParams, error) {
            if (error.notAuthorized) {
                $state.go('app.home');
            }
        });
    }
})();
(function () {
    'use strict';

    angular.module('app.home').config(Configuration);

    Configuration.$inject = ['$stateProvider'];

    function Configuration($stateProvider) {
        $stateProvider
            .state('app.home', {
                url: '/home',
                templateUrl: '/partials/components/home/homeView',
                controller: 'HomeCtrl',
                controllerAs: 'vm',
                title: 'Home',
                bodyCss: 'home'
            });
    }

})();
(function () {
    'use strict';

    angular.module('app.profile').config(Configuration);

    Configuration.$inject = ['$stateProvider'];

    function Configuration($stateProvider) {
        var routeRoleChecks = {
            user: {
                auth: function (authService) {
                    return authService.authorizeAuthenticatedUserForRoute();
                }
            }
        };

        $stateProvider
            .state('app.profile', {
                url: '/profile',
                templateUrl: '/partials/components/profile/profileView',
                controller: 'ProfileCtrl',
                controllerAs: 'vm',
                resolve: routeRoleChecks.user,
                title: 'Profile',
                bodyCss: 'profile'
            });
    }

})();
(function () {
    'use strict';

    angular.module('app.recipes').config(Configuration);

    Configuration.$inject = ['$stateProvider'];

    function Configuration($stateProvider) {
        $stateProvider
            .state('app.recipes', {
                url: '/recipes',
                templateUrl: '/partials/components/recipes/recipesView',
                controller: 'RecipesCtrl',
                controllerAs: 'vm',
                title: 'Recipes',
                bodyCss: 'recipes'
            })
            .state('app.recipeDetails', {
                url: '/recipe/:id',
                templateUrl: '/partials/components/recipes/recipeDetailsView',
                controller: 'RecipeDetailsCtrl',
                controllerAs: 'vm',
                title: 'Recipe Details',
                bodyCss: 'recipe-details'
            });
    }

})();
(function () {
    'use strict';

    var appSignUp = angular.module('app.signUp');

    //=========================================================================
    // Config.
    //=========================================================================
    appSignUp.config(Configuration);

    Configuration.$inject = ['$stateProvider'];

    function Configuration($stateProvider) {
        $stateProvider
            .state('app.signUp', {
                url: '/sign-up',
                templateUrl: '/partials/components/signUp/signUpView',
                controller: 'SignUpCtrl',
                controllerAs: 'vm',
                title: 'Sign Up',
                bodyCss: 'sign-up'
            });
    }

})();
(function () {
    'use strict';

    angular.module('app.providers').config(Configuration);

    Configuration.$inject = [];

    function Configuration() {

    }

})();
(function () {
    'use strict';

    angular.module('app.resources').config(Configuration);

    Configuration.$inject = [];

    function Configuration() {

    }

})();
(function () {
    'use strict';

    angular.module('app.services').config(Configuration);

    Configuration.$inject = [];

    function Configuration() {

    }

})();
(function () {
    'use strict';

    angular.module('app').controller('ContentCtrl', ContentCtrl);

    ContentCtrl.$inject = ['logger'];

    function ContentCtrl(logger) {
        var vm = this;

        init();

        function init() {
            logger.debug(ContentCtrl, init, 'Initializing...');
        }

    }
})();
(function () {
    'use strict';

    angular.module('app').controller('FooterCtrl', FooterCtrl);

    FooterCtrl.$inject = ['logger'];

    function FooterCtrl(logger) {
        var vm = this;

        init();

        function init() {
            logger.debug(FooterCtrl, init, 'Initializing...');
        }

    }
})();
(function () {
    'use strict';

    angular.module('app').controller('NavCtrl', NavCtrl);

    NavCtrl.$inject = ['logger', '$http', '$state', 'notificationProvider', 'identityService', 'authService'];

    function NavCtrl(logger, $http, $state, notificationProvider, identityService, authService) {
        var vm = this;

        //=====================================================================
        // Expose functions.
        //=====================================================================
        vm.logIn = logIn;
        vm.logOut = logOut;

        //=====================================================================
        // Initialization.
        //=====================================================================
        init();

        function init() {
            logger.debug(NavCtrl, init, 'Initializing...');
            vm.identity = identityService;
        }

        //=====================================================================
        // Exposed functions implementation.
        //=====================================================================
        function logIn() {
            logger.debug(NavCtrl, logIn, 'Signing in...');

            authService.authenticateUser(vm.username, vm.password)
                .then(function (success) {
                    if (success) {
                        notificationProvider.success('You have successfully logged in.');
                    } else {
                        notificationProvider.error('Invalid user name or password!');
                    }
                });
        }

        function logOut() {
            logger.debug(NavCtrl, logOut, 'Signing in...');

            authService.logOutUser()
                .then(function () {
                    vm.username = '';
                    vm.password = '';
                    notificationProvider.info('You have been logged out.');
                    $state.go('app.home');
                });
        }

    }
})();
(function () {
    'use strict';

    angular.module('app').controller('SidebarCtrl', SidebarCtrl);

    SidebarCtrl.$inject = ['logger'];

    function SidebarCtrl(logger) {
        var vm = this;

        init();

        function init() {
            logger.debug(SidebarCtrl, init, 'Initializing...');
            vm.test = 'test string';
        }

    }
})();
(function () {
    'use strict';

    angular.module('app.admin').controller('UserListCtrl', UserListCtrl);

    UserListCtrl.$inject = ['$scope', 'logger', 'UserResource'];

    function UserListCtrl($scope, logger, UserResource) {
        var vm = this;

        init();

        function init() {
            logger.debug(UserListCtrl, init, 'Initializing...');
            vm.users = UserResource.query();
        }
    }
})();
(function () {
    'use strict';

    angular.module('app.home').controller('HomeCtrl', HomeCtrl);

    HomeCtrl.$inject = ['$scope', 'logger'];

    function HomeCtrl($scope, logger) {
        var vm = this;

        init();

        function init() {
            logger.debug(HomeCtrl, init, 'Initializing...');
        }
    }
})();
(function () {
    'use strict';

    angular.module('app.profile').controller('ProfileCtrl', ProfileCtrl);

    ProfileCtrl.$inject = ['$scope', 'logger', 'validation', 'authService', 'identityService', 'notificationProvider'];

    function ProfileCtrl($scope, logger, validation, authService, identityService, notificationProvider) {
        var vm = this;

        //=====================================================================
        // Exposed functions.
        //=====================================================================
        vm.getClass = validation.getClass;
        vm.update = update;

        //=====================================================================
        // Initialization.
        //=====================================================================
        init();

        function init() {
            logger.debug(ProfileCtrl, init, 'Initializing...');

            // Update view.
            vm.email = identityService.currentUser.username;
            vm.firstName = identityService.currentUser.firstName;
            vm.lastName = identityService.currentUser.lastName;
        }

        //=====================================================================
        // Exposed functions implementation.
        //=====================================================================
        function update() {
            logger.debug(ProfileCtrl, update, 'Updating user profile...');
            vm.isLoading = true;

            var newUserData = {
                username: vm.email,
                firstName: vm.firstName,
                lastName: vm.lastName
            };

            if (vm.password && vm.password.length > 0) {
                newUserData.password = vm.password;
            }

            authService.updateCurrentUser(newUserData)
                .then(function () {
                    notificationProvider.success('Your user profile has been updated.');
                })
                .catch(function (reason) {
                    notificationProvider.error(reason);
                })
                .finally(function () {
                    vm.isLoading = false;
                });
        }
    }
})();
(function () {
    'use strict';

    angular.module('app.recipes').controller('RecipeDetailsCtrl', RecipeDetailsCtrl);

    RecipeDetailsCtrl.$inject = ['$scope', '$http', 'logger', '$stateParams', 'RecipeResource', 'identityService', 'notificationProvider'];

    function RecipeDetailsCtrl($scope, $http, logger, $stateParams, RecipeResource, identityService, notificationProvider) {
        var vm = this;

        //=====================================================================
        // Exposed functions.
        //=====================================================================
        vm.getIngredientDisplay = getIngredientDisplay;
        vm.toggleStar = toggleStar;
        vm.identity = identityService;

        //=====================================================================
        // Initialization.
        //=====================================================================
        init();

        function init() {
            logger.debug(RecipeDetailsCtrl, init, 'Initializing...');

            RecipeResource.get({ _id: $stateParams.id }, function (data) {
                vm.recipe = data;
            });
        }

        //=====================================================================
        // Exposed functions implementation.
        //=====================================================================
        function getIngredientDisplay(ingredient) {
            var quantityStr = ingredient.quantity.trim();
            var nameStr = ingredient.name.trim();

            if (!isNaN(ingredient.quantity)) {
                quantityStr += ' x ';
                if (ingredient.quantity > 1) {
                    nameStr += 's';
                }
            } else {
                quantityStr += ' of '
            }

            return quantityStr + nameStr;
        }

        function toggleStar() {
            var url = '/api/recipes/' + vm.recipe._id + '/toggle-star';
            var promise = $http.put(url, { star: !vm.recipe.isStarred() });

            promise
                .then(function (response) {
                    vm.recipe.starredByUsers = response.data.starredByUsers;
                })
                .catch(function (errorResponse) {
                    notificationProvider.error('Failed to update recipe.');
                });
        }
    }
})();
(function () {
    'use strict';

    angular.module('app.recipes').controller('RecipesCtrl', RecipesCtrl);

    RecipesCtrl.$inject = ['$scope', 'logger', 'RecipeResource', 'identityService'];

    function RecipesCtrl($scope, logger, RecipeResource, identityService) {
        var vm = this;

        //=====================================================================
        // Constants.
        //=====================================================================
        vm.pageNumber = 1;
        vm.pageSize = 10;
        vm.debounce = { debounce: 300 };

        //=====================================================================
        // Exposed functions.
        //=====================================================================
        vm.getFiltered = getFiltered;
        vm.update = update;
        vm.getMainIngredientsStr = getMainIngredientsStr;
        vm.identity = identityService;

        //=====================================================================
        // Initialization.
        //=====================================================================
        init();

        function init() {
            logger.debug(RecipesCtrl, init, 'Initializing...');
            RecipeResource.query(function (data) {
                vm.recipes = _.sortBy(data, 'name');
                vm.update();
            });
        }

        //=====================================================================
        // Exposed functions implementation.
        //=====================================================================
        function getStarred() {
            if (!identityService.currentUser) return [];

            return _.filter(vm.recipes, function (recipe) {
                return recipe.starredByUsers.indexOf(identityService.currentUser._id) >= 0
            });
        }

        function getFiltered() {
            var lowerCaseSearch = vm.search ? vm.search.toLowerCase() : null;

            var result = _.filter(vm.recipes, function (recipe) {
                var searchResult = !vm.search
                    || recipe.name.toLowerCase().indexOf(lowerCaseSearch) >= 0
                    || _.filter(recipe.ingredients, function (ingredient) {
                        return ingredient.name.toLowerCase().indexOf(lowerCaseSearch) >= 0;
                    }).length > 0;

                var maxTimeResult = !vm.maxTime || recipe.time <= vm.maxTime;

                var starredResult = !vm.starred || recipe.starredByUsers.indexOf(identityService.currentUser._id) >= 0;

                return searchResult && maxTimeResult && starredResult;
            });

            return result;
        }

        function update() {
            vm.starredRecipes = getStarred();
            vm.filteredRecipes = getFiltered();

            // Calculate page.
            vm.startIndex = Math.max((vm.pageNumber - 1) * vm.pageSize, 0);
            vm.endIndex = Math.min(vm.pageNumber * vm.pageSize, vm.filteredRecipes.length);
            vm.pagedRecipes = vm.filteredRecipes.slice(vm.startIndex, vm.endIndex);
        }

        function getMainIngredientsStr(ingredients) {
            var mainIngredients = _.filter(ingredients, function (ingredient) {
                return ingredient.isMain;
            });

            var names = _.map(mainIngredients, function (ingredient) {
                if (!isNaN(ingredient.quantity)) {
                    return ingredient.name.trim() + 's';
                }

                return ingredient.name.trim();
            });

            var joinedStr = names.join(', ');
            if (joinedStr.length > 0) {
                joinedStr = joinedStr[0].toUpperCase() + joinedStr.slice(1);
                joinedStr += '.';
            }

            return joinedStr;
        }
    }
})();
(function () {
    'use strict';

    angular.module('app.signUp').controller('SignUpCtrl', SignUpCtrl);

    SignUpCtrl.$inject = ['$scope', '$state', 'logger', 'notificationProvider', 'validation', 'authService'];

    function SignUpCtrl($scope, $state, logger, notificationProvider, validation, authService) {
        var vm = this;

        //=====================================================================
        // Exposed functions.
        //=====================================================================
        vm.getClass = validation.getClass;
        vm.signUp = signUp;

        //=====================================================================
        // Initialization.
        //=====================================================================
        init();

        function init() {
            logger.debug(SignUpCtrl, init, 'Initializing...');
        }

        //=====================================================================
        // Exposed functions implementation.
        //=====================================================================
        function signUp() {
            logger.debug(SignUpCtrl, signUp, 'Submitting form...');
            vm.isLoading = true;

            var newUserData = {
                username: vm.email,
                password: vm.password,
                firstName: vm.firstName,
                lastName: vm.lastName
            };

            authService.createUser(newUserData)
                .then(function () {
                    notificationProvider.success('User successfully created.');
                    $state.go('app.home');
                })
                .catch(function (errorResponse) {
                    notificationProvider.error(errorResponse);
                })
                .finally(function () {
                    vm.isLoading = false;
                });
        }
    }
})();
(function () {
    'use strict';

    angular.module('app.providers').factory('logger', Logger);

    Logger.$inject = ['$log'];

    function Logger($log) {
        //=====================================================================
        // Exposed functions.
        //=====================================================================
        function debug(ctrl, func, msg) {
            $log.debug(buildMsg(ctrl, func, msg));
        }

        function error(ctrl, func, msg) {
            $log.error(buildMsg(ctrl, func, msg));
        }

        function info(ctrl, func, msg) {
            $log.info(buildMsg(ctrl, func, msg));
        }

        function log(ctrl, func, msg) {
            $log.log(buildMsg(ctrl, func, msg));
        }

        function warn(ctrl, func, msg) {
            $log.warn(buildMsg(ctrl, func, msg));
        }

        //=====================================================================
        // Helper functions.
        //=====================================================================
        function buildMsg(ctrl, func, msg) {
            return ctrl.name + ' -> ' + func.name + '(): ' + msg;
        }

        //=====================================================================
        // Expose functions.
        //=====================================================================
        return {
            debug: debug,
            error: error,
            info: info,
            log: log,
            warn: warn
        };
    }

})();

(function () {
    'use strict';

    angular.module('app.providers').value('toastr', toastr);
    angular.module('app.providers').factory('notificationProvider', NotificationProvider);

    NotificationProvider.$inject = ['toastr', 'logger'];

    function NotificationProvider(toastr, logger) {
        //=====================================================================
        // Toastr options.
        //=====================================================================
        toastr.options = {
            closeButton: false,
            debug: false,
            newestOnTop: false,
            progressBar: false,
            positionClass: 'toast-top-center',
            preventDuplicates: false,
            onclick: null,
            showDuration: 500,
            hideDuration: 1000,
            timeOut: 2000,
            extendedTimeOut: 1000,
            showEasing: 'swing',
            hideEasing: 'linear',
            showMethod: 'fadeIn',
            hideMethod: 'fadeOut'
        };

        //=====================================================================
        // Public functions.
        //=====================================================================
        function success(msg) {
            toastr.success(msg);
            logger.debug(NotificationProvider, success, msg);
        }

        function info(msg) {
            toastr.info(msg);
            logger.debug(NotificationProvider, info, msg);
        }

        function warning(msg) {
            toastr.warning(msg);
            logger.debug(NotificationProvider, warning, msg);
        }

        function error(msg) {
            toastr.error(msg);
            logger.debug(NotificationProvider, error, msg);
        }

        //=====================================================================
        // Expose functions.
        //=====================================================================
        return {
            success: success,
            info: info,
            warning: warning,
            error: error
        };
    }

})();
(function () {
    'use strict';

    angular.module('app.providers').factory('validation', Validation);

    Validation.$inject = [];

    function Validation() {
        //=====================================================================
        // Exposed functions.
        //=====================================================================
        function hasError(form, formElement) {
            return form.$submitted && formElement.$invalid;
        }

        function hasWarn(form, formElement) {
            return !form.$submitted && formElement.$dirty && formElement.$invalid;
        }

        function hasSuccess(formElement) {
            return formElement.$dirty && !formElement.$invalid;
        }

        function getClass(form, formElement) {
            return {
                'has-error': hasError(form, formElement),
                'has-warning': hasWarn(form, formElement),
                'has-success': hasSuccess(formElement)
            };
        }

        //=====================================================================
        // Expose functions.
        //=====================================================================
        return {
            hasError: hasError,
            hasWarn: hasWarn,
            hasSuccess: hasSuccess,
            getClass: getClass
        };
    }

})();
(function () {
    'use strict';

    angular.module('app.resources').factory('RecipeResource', RecipeResource);

    RecipeResource.$inject = ['$resource', 'identityService'];

    function RecipeResource($resource, identityService) {
        //=====================================================================
        // Resource.
        //=====================================================================
        var RecipeRes = $resource('/api/recipes/:_id', { _id: '@id' }, {
            update: { method: 'PUT', isArray: false }
        });

        RecipeRes.prototype.isStarred = function () {
            return identityService.currentUser && this.starredByUsers.indexOf(identityService.currentUser._id) >= 0;
        };

        return RecipeRes;
    }

})();
(function () {
    'use strict';

    angular.module('app.resources').factory('UserResource', UserResource);

    UserResource.$inject = ['$resource'];

    function UserResource($resource) {
        //=====================================================================
        // Resource.
        //=====================================================================
        var UserRes = $resource('/api/users/:id', {_id: '@id'}, {
            update: { method: 'PUT', isArray: false }
        });

        UserRes.prototype.isAdmin = function () {
            return this.roles && this.roles.indexOf('admin') >= 0;
        };

        return UserRes;
    }

})();
(function () {
    'use strict';

    angular.module('app.services').factory('authService', AuthService);

    AuthService.$inject = ['$http', '$q', 'logger', 'identityService', 'UserResource'];

    function AuthService($http, $q, logger, identityService, UserResource) {
        //=====================================================================
        // Variables.
        //=====================================================================
        var notAuthorizedObj = { notAuthorized: true };

        //=====================================================================
        // Public functions.
        //=====================================================================
        function authenticateUser(username, password) {
            var deferred = $q.defer();

            $http.post('/login', {
                username: username,
                password: password
            }).then(function (response) {
                if (response.data.success) {
                    var user = new UserResource();
                    angular.extend(user, response.data.user);

                    // Save current user.
                    identityService.currentUser = user;

                    deferred.resolve(true);
                } else {
                    deferred.resolve(false);
                }
            });

            return deferred.promise;
        }

        function logOutUser() {
            var deferred = $q.defer();

            $http.post('/logout', { logOut: true })
                .then(function () {
                    identityService.currentUser = null;
                    deferred.resolve();
                });

            return deferred.promise;
        }

        function createUser(newUserData) {
            var deferred = $q.defer();
            var newUser = new UserResource(newUserData);

            newUser.$save()
                .then(function () {
                    identityService.currentUser = newUser;
                    deferred.resolve();
                })
                .catch(function (errorResponse) {
                    deferred.reject(errorResponse.data.reason);
                });

            return deferred.promise;
        }

        function updateCurrentUser(newUserData) {
            var deferred = $q.defer();

            var clone = angular.copy(identityService.currentUser);
            angular.extend(clone, newUserData);

            clone.$update()
                .then(function () {
                    identityService.currentUser = clone;
                    deferred.resolve();
                })
                .catch(function (errorResponse) {
                    deferred.reject(errorResponse.data.reason);
                });

            return deferred.promise;
        }

        function authorizeCurrentUserForRoute(role) {
            if (identityService.isAuthorized(role)) {
                return true;
            } else {
                return $q.reject(notAuthorizedObj);
            }
        }

        function authorizeAuthenticatedUserForRoute() {
            if (identityService.isAuthenticated()) {
                return true;
            } else {
                return $q.reject(notAuthorizedObj);
            }
        }

        //=====================================================================
        // Expose functions.
        //=====================================================================
        return {
            authenticateUser: authenticateUser,
            logOutUser: logOutUser,
            createUser: createUser,
            updateCurrentUser: updateCurrentUser,
            authorizeCurrentUserForRoute: authorizeCurrentUserForRoute,
            authorizeAuthenticatedUserForRoute: authorizeAuthenticatedUserForRoute
        };
    }

})();
(function () {
    'use strict';

    angular.module('app.services').factory('identityService', IdentityService);

    IdentityService.$inject = ['$window', 'logger', 'UserResource'];

    function IdentityService($window, logger, UserResource) {
        //=====================================================================
        // Handle bootstrapped current user object.
        //=====================================================================
        var currentUser = null;

        if (!!$window.bootstrappedUserObject) {
            currentUser = new UserResource();
            angular.extend(currentUser, $window.bootstrappedUserObject);
        }

        //=====================================================================
        // Public functions.
        //=====================================================================
        function isAuthenticated() {
            return !!this.currentUser;
        }

        function isAuthorized(role) {
            return !!this.currentUser && this.currentUser.roles.indexOf(role) >= 0;
        }

        //=====================================================================
        // Expose functions.
        //=====================================================================
        return {
            currentUser: currentUser,
            isAuthenticated: isAuthenticated,
            isAuthorized: isAuthorized
        };
    }

})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJjb21wb25lbnRzL2FkbWluL2FwcC5hZG1pbi5tb2R1bGUuanMiLCJjb21wb25lbnRzL2hvbWUvYXBwLmhvbWUubW9kdWxlLmpzIiwiY29tcG9uZW50cy9wcm9maWxlL2FwcC5wcm9maWxlLm1vZHVsZS5qcyIsImNvbXBvbmVudHMvcmVjaXBlcy9hcHAucmVjaXBlcy5tb2R1bGUuanMiLCJjb21wb25lbnRzL3NpZ25VcC9hcHAuc2lnblVwLm1vZHVsZS5qcyIsInNoYXJlZC9wcm92aWRlcnMvYXBwLnByb3ZpZGVycy5tb2R1bGUuanMiLCJzaGFyZWQvcmVzb3VyY2VzL2FwcC5yZXNvdXJjZXMubW9kdWxlLmpzIiwic2hhcmVkL3NlcnZpY2VzL2FwcC5zZXJ2aWNlcy5tb2R1bGUuanMiLCJhcHAuY29uZmlnLmpzIiwiY29tcG9uZW50cy9hZG1pbi9hcHAuYWRtaW4uY29uZmlnLmpzIiwiY29tcG9uZW50cy9ob21lL2FwcC5ob21lLmNvbmZpZy5qcyIsImNvbXBvbmVudHMvcHJvZmlsZS9hcHAucHJvZmlsZS5jb25maWcuanMiLCJjb21wb25lbnRzL3JlY2lwZXMvYXBwLnJlY2lwZXMuY29uZmlnLmpzIiwiY29tcG9uZW50cy9zaWduVXAvYXBwLnNpZ25VcC5jb25maWcuanMiLCJzaGFyZWQvcHJvdmlkZXJzL2FwcC5wcm92aWRlcnMuY29uZmlnLmpzIiwic2hhcmVkL3Jlc291cmNlcy9hcHAucmVzb3VyY2VzLmNvbmZpZy5qcyIsInNoYXJlZC9zZXJ2aWNlcy9hcHAuc2VydmljZXMuY29uZmlnLmpzIiwibGF5b3V0L2NvbnRlbnRDdHJsLmpzIiwibGF5b3V0L2Zvb3RlckN0cmwuanMiLCJsYXlvdXQvbmF2Q3RybC5qcyIsImxheW91dC9zaWRlYmFyQ3RybC5qcyIsImNvbXBvbmVudHMvYWRtaW4vdXNlckxpc3RDdHJsLmpzIiwiY29tcG9uZW50cy9ob21lL2hvbWVDdHJsLmpzIiwiY29tcG9uZW50cy9wcm9maWxlL3Byb2ZpbGVDdHJsLmpzIiwiY29tcG9uZW50cy9yZWNpcGVzL3JlY2lwZURldGFpbHNDdHJsLmpzIiwiY29tcG9uZW50cy9yZWNpcGVzL3JlY2lwZXNDdHJsLmpzIiwiY29tcG9uZW50cy9zaWduVXAvc2lnblVwQ3RybC5qcyIsInNoYXJlZC9wcm92aWRlcnMvbG9nZ2VyLmpzIiwic2hhcmVkL3Byb3ZpZGVycy9ub3RpZmljYXRpb25Qcm92aWRlci5qcyIsInNoYXJlZC9wcm92aWRlcnMvdmFsaWRhdGlvbi5qcyIsInNoYXJlZC9yZXNvdXJjZXMvcmVjaXBlUmVzb3VyY2UuanMiLCJzaGFyZWQvcmVzb3VyY2VzL3VzZXJSZXNvdXJjZS5qcyIsInNoYXJlZC9zZXJ2aWNlcy9hdXRoU2VydmljZS5qcyIsInNoYXJlZC9zZXJ2aWNlcy9pZGVudGl0eVNlcnZpY2UuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsSUFBQSxNQUFBLFFBQUEsT0FBQSxPQUFBOztRQUVBO1FBQ0E7UUFDQTtRQUNBOzs7UUFHQTtRQUNBOzs7UUFHQTtRQUNBO1FBQ0E7OztRQUdBO1FBQ0E7UUFDQTs7O0FDdEJBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxhQUFBOzs7OztBQ0hBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBOzs7OztBQ0hBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxlQUFBOzs7OztBQ0hBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxlQUFBOzs7OztBQ0hBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxjQUFBOzs7OztBQ0hBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxpQkFBQTs7O0FDSEEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLGlCQUFBOzs7QUNIQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsZ0JBQUE7OztBQ0hBLENBQUEsWUFBQTtJQUNBOztJQUVBLElBQUEs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QUFBO1lBQ0EsS0FBQSxLQUFBLFNBQUEsTUFBQSxNQUFBOzs7UUFHQSxTQUFBLElBQUEsTUFBQSxNQUFBLEtBQUE7WUFDQSxLQUFBLElBQUEsU0FBQSxNQUFBLE1BQUE7OztRQUdBLFNBQUEsS0FBQSxNQUFBLE1BQUEsS0FBQTtZQUNBLEtBQUEsS0FBQSxTQUFBLE1BQUEsTUFBQTs7Ozs7O1FBTUEsU0FBQSxTQUFBLE1BQUEsTUFBQSxLQUFBO1lBQ0EsT0FBQSxLQUFBLE9BQUEsU0FBQSxLQUFBLE9BQUEsU0FBQTs7Ozs7O1FBTUEsT0FBQTtZQUNBLE9BQUE7WUFDQSxPQUFBO1lBQ0EsTUFBQTtZQUNBLEtBQUE7WUFDQSxNQUFBOzs7Ozs7QUM3Q0EsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLGlCQUFBLE1BQUEsVUFBQTtJQUNBLFFBQUEsT0FBQSxpQkFBQSxRQUFBLHdCQUFBOztJQUVBLHFCQUFBLFVBQUEsQ0FBQSxVQUFBOztJQUVBLFNBQUEscUJBQUEsUUFBQSxRQUFBOzs7O1FBSUEsT0FBQSxVQUFBO1lBQ0EsYUFBQTtZQUNBLE9BQUE7WUFDQSxhQUFBO1lBQ0EsYUFBQTtZQUNBLGVBQUE7WUFDQSxtQkFBQTtZQUNBLFNBQUE7WUFDQSxjQUFBO1lBQ0EsY0FBQTtZQUNBLFNBQUE7WUFDQSxpQkFBQTtZQUNBLFlBQUE7WUFDQSxZQUFBO1lBQ0EsWUFBQTtZQUNBLFlBQUE7Ozs7OztRQU1BLFNBQUEsUUFBQSxLQUFBO1lBQ0EsT0FBQSxRQUFBO1lBQ0EsT0FBQSxNQUFBLHNCQUFBLFNBQUE7OztRQUdBLFNBQUEsS0FBQSxLQUFBO1lBQ0EsT0FBQSxLQUFBO1lBQ0EsT0FBQSxNQUFBLHNCQUFBLE1BQUE7OztRQUdBLFNBQUEsUUFBQSxLQUFBO1lBQ0EsT0FBQSxRQUFBO1lBQ0EsT0FBQSxNQUFBLHNCQUFBLFNBQUE7OztRQUdBLFNBQUEsTUFBQSxLQUFBO1lBQ0EsT0FBQSxNQUFBO1lBQ0EsT0FBQSxNQUFBLHNCQUFBLE9BQUE7Ozs7OztRQU1BLE9BQUE7WUFDQSxTQUFBO1lBQ0EsTUFBQTtZQUNBLFNBQUE7WUFDQSxPQUFBOzs7OztBQzdEQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsaUJBQUEsUUFBQSxjQUFBOztJQUVBLFdBQUEsVUFBQTs7SUFFQSxTQUFBLGFBQUE7Ozs7UUFJQSxTQUFBLFNBQUEsTUFBQSxhQUFBO1lBQ0EsT0FBQSxLQUFBLGNBQUEsWUFBQTs7O1FBR0EsU0FBQSxRQUFBLE1BQUEsYUFBQTtZQUNBLE9BQUEsQ0FBQSxLQUFBLGNBQUEsWUFBQSxVQUFBLFlBQUE7OztRQUdBLFNBQUEsV0FBQSxhQUFBO1lBQ0EsT0FBQSxZQUFBLFVBQUEsQ0FBQSxZQUFBOzs7UUFHQSxTQUFBLFNBQUEsTUFBQSxhQUFBO1lBQ0EsT0FBQTtnQkFDQSxhQUFBLFNBQUEsTUFBQTtnQkFDQSxlQUFBLFFBQUEsTUFBQTtnQkFDQSxlQUFBLFdBQUE7Ozs7Ozs7UUFPQSxPQUFBO1lBQ0EsVUFBQTtZQUNBLFNBQUE7WUFDQSxZQUFBO1lBQ0EsVUFBQTs7Ozs7QUN0Q0EsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLGlCQUFBLFFBQUEsa0JBQUE7O0lBRUEsZUFBQSxVQUFBLENBQUEsYUFBQTs7SUFFQSxTQUFBLGVBQUEsV0FBQSxpQkFBQTs7OztRQUlBLElBQUEsWUFBQSxVQUFBLHFCQUFBLEVBQUEsS0FBQSxTQUFBO1lBQ0EsUUFBQSxFQUFBLFFBQUEsT0FBQSxTQUFBOzs7UUFHQSxVQUFBLFVBQUEsWUFBQSxZQUFBO1lBQ0EsT0FBQSxnQkFBQSxlQUFBLEtBQUEsZUFBQSxRQUFBLGdCQUFBLFlBQUEsUUFBQTs7O1FBR0EsT0FBQTs7OztBQ25CQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsaUJBQUEsUUFBQSxnQkFBQTs7SUFFQSxhQUFBLFVBQUEsQ0FBQTs7SUFFQSxTQUFBLGFBQUEsV0FBQTs7OztRQUlBLElBQUEsVUFBQSxVQUFBLGtCQUFBLENBQUEsS0FBQSxRQUFBO1lBQ0EsUUFBQSxFQUFBLFFBQUEsT0FBQSxTQUFBOzs7UUFHQSxRQUFBLFVBQUEsVUFBQSxZQUFBO1lBQ0EsT0FBQSxLQUFBLFNBQUEsS0FBQSxNQUFBLFFBQUEsWUFBQTs7O1FBR0EsT0FBQTs7OztBQ25CQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsZ0JBQUEsUUFBQSxlQUFBOztJQUVBLFlBQUEsVUFBQSxDQUFBLFNBQUEsTUFBQSxVQUFBLG1CQUFBOztJQUVBLFNBQUEsWUFBQSxPQUFBLElBQUEsUUFBQSxpQkFBQSxjQUFBOzs7O1FBSUEsSUFBQSxtQkFBQSxFQUFBLGVBQUE7Ozs7O1FBS0EsU0FBQSxpQkFBQSxVQUFBLFVBQUE7WUFDQSxJQUFBLFdBQUEsR0FBQTs7WUFFQSxNQUFBLEtBQUEsVUFBQTtnQkFDQSxVQUFBO2dCQUNBLFVBQUE7ZUFDQSxLQUFBLFVBQUEsVUFBQTtnQkFDQSxJQUFBLFNBQUEsS0FBQSxTQUFBO29CQUNBLElBQUEsT0FBQSxJQUFBO29CQUNBLFFBQUEsT0FBQSxNQUFBLFNBQUEsS0FBQTs7O29CQUdBLGdCQUFBLGNBQUE7O29CQUVBLFNBQUEsUUFBQTt1QkFDQTtvQkFDQSxTQUFBLFFBQUE7Ozs7WUFJQSxPQUFBLFNBQUE7OztRQUdBLFNBQUEsYUFBQTtZQUNBLElBQUEsV0FBQSxHQUFBOztZQUVBLE1BQUEsS0FBQSxXQUFBLEVBQUEsUUFBQTtpQkFDQSxLQUFBLFlBQUE7b0JBQ0EsZ0JBQUEsY0FBQTtvQkFDQSxTQUFBOzs7WUFHQSxPQUFBLFNBQUE7OztRQUdBLFNBQUEsV0FBQSxhQUFBO1lBQ0EsSUFBQSxXQUFBLEdBQUE7WUFDQSxJQUFBLFVBQUEsSUFBQSxhQUFBOztZQUVBLFFBQUE7aUJBQ0EsS0FBQSxZQUFBO29CQUNBLGdCQUFBLGNBQUE7b0JBQ0EsU0FBQTs7aUJBRUEsTUFBQSxVQUFBLGVBQUE7b0JBQ0EsU0FBQSxPQUFBLGNBQUEsS0FBQTs7O1lBR0EsT0FBQSxTQUFBOzs7UUFHQSxTQUFBLGtCQUFBLGFBQUE7WUFDQSxJQUFBLFdBQUEsR0FBQTs7WUFFQSxJQUFBLFFBQUEsUUFBQSxLQUFBLGdCQUFBO1lBQ0EsUUFBQSxPQUFBLE9BQUE7O1lBRUEsTUFBQTtpQkFDQSxLQUFBLFlBQUE7b0JBQ0EsZ0JBQUEsY0FBQTtvQkFDQSxTQUFBOztpQkFFQSxNQUFBLFVBQUEsZUFBQTtvQkFDQSxTQUFBLE9BQUEsY0FBQSxLQUFBOzs7WUFHQSxPQUFBLFNBQUE7OztRQUdBLFNBQUEsNkJBQUEsTUFBQTtZQUNBLElBQUEsZ0JBQUEsYUFBQSxPQUFBO2dCQUNBLE9BQUE7bUJBQ0E7Z0JBQ0EsT0FBQSxHQUFBLE9BQUE7Ozs7UUFJQSxTQUFBLHFDQUFBO1lBQ0EsSUFBQSxnQkFBQSxtQkFBQTtnQkFDQSxPQUFBO21CQUNBO2dCQUNBLE9BQUEsR0FBQSxPQUFBOzs7Ozs7O1FBT0EsT0FBQTtZQUNBLGtCQUFBO1lBQ0EsWUFBQTtZQUNBLFlBQUE7WUFDQSxtQkFBQTtZQUNBLDhCQUFBO1lBQ0Esb0NBQUE7Ozs7O0FDOUdBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxnQkFBQSxRQUFBLG1CQUFBOztJQUVBLGdCQUFBLFVBQUEsQ0FBQSxXQUFBLFVBQUE7O0lBRUEsU0FBQSxnQkFBQSxTQUFBLFFBQUEsY0FBQTs7OztRQUlBLElBQUEsY0FBQTs7UUFFQSxJQUFBLENBQUEsQ0FBQSxRQUFBLHdCQUFBO1lBQ0EsY0FBQSxJQUFBO1lBQ0EsUUFBQSxPQUFBLGFBQUEsUUFBQTs7Ozs7O1FBTUEsU0FBQSxrQkFBQTtZQUNBLE9BQUEsQ0FBQSxDQUFBLEtBQUE7OztRQUdBLFNBQUEsYUFBQSxNQUFBO1lBQ0EsT0FBQSxDQUFBLENBQUEsS0FBQSxlQUFBLEtBQUEsWUFBQSxNQUFBLFFBQUEsU0FBQTs7Ozs7O1FBTUEsT0FBQTtZQUNBLGFBQUE7WUFDQSxpQkFBQTtZQUNBLGNBQUE7Ozs7S0FJQSIsImZpbGUiOiJwdWJsaWMvYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbXG4gICAgICAgIC8vIFByZWRlZmluZWQgbW9kdWxlcy5cbiAgICAgICAgJ3VpLmJvb3RzdHJhcCcsXG4gICAgICAgICd1aS5yb3V0ZXInLFxuICAgICAgICAnbmdSZXNvdXJjZScsXG4gICAgICAgICduZ1JvdXRlJyxcblxuICAgICAgICAvLyBBcHAgY29tcG9uZW50cy5cbiAgICAgICAgJ2FwcC5ob21lJyxcbiAgICAgICAgJ2FwcC5yZWNpcGVzJyxcblxuICAgICAgICAvLyBBZG1pbiBjb21wb25lbnRzLlxuICAgICAgICAnYXBwLmFkbWluJyxcbiAgICAgICAgJ2FwcC5wcm9maWxlJyxcbiAgICAgICAgJ2FwcC5zaWduVXAnLFxuXG4gICAgICAgIC8vIEFwcCBzaGFyZWQuXG4gICAgICAgICdhcHAucHJvdmlkZXJzJyxcbiAgICAgICAgJ2FwcC5zZXJ2aWNlcycsXG4gICAgICAgICdhcHAucmVzb3VyY2VzJ1xuICAgIF0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuYWRtaW4nLCBbXG5cbiAgICBdKTtcblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuaG9tZScsIFtcblxuICAgIF0pO1xuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5wcm9maWxlJywgW1xuXG4gICAgXSk7XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnJlY2lwZXMnLCBbXG5cbiAgICBdKTtcblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuc2lnblVwJywgW1xuXG4gICAgXSk7XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnByb3ZpZGVycycsIFtdKTtcblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAucmVzb3VyY2VzJywgW10pO1xuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlcycsIFtdKTtcblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XG5cbiAgICBhcHAuY29uZmlnKENvbmZpZ3VyYXRpb24pO1xuXG4gICAgQ29uZmlndXJhdGlvbi4kaW5qZWN0ID0gWyckbG9nUHJvdmlkZXInLCAnJHN0YXRlUHJvdmlkZXInLCAnJHVybFJvdXRlclByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJ107XG5cbiAgICBmdW5jdGlvbiBDb25maWd1cmF0aW9uKCRsb2dQcm92aWRlciwgJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcbiAgICAgICAgLy8gTG9nZ2luZy5cbiAgICAgICAgJGxvZ1Byb3ZpZGVyLmRlYnVnRW5hYmxlZCh0cnVlKTtcblxuICAgICAgICAvLyBIVE1MNSBtb2RlLlxuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUoe1xuICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgIHJlcXVpcmVCYXNlOiBmYWxzZVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBbHdheXMgZGVmYXVsdCB0byBob21lIHBhZ2UuXG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy9hcHAvaG9tZScpO1xuXG4gICAgICAgIC8vIFJvdXRlcy5cbiAgICAgICAgdmFyIGRlZmF1bHRDdHJsQXMgPSAndm0nO1xuICAgICAgICB2YXIgbWFpblZpZXdzT2JqID0ge1xuICAgICAgICAgICAgbmF2OiB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvbGF5b3V0L25hdlRtcGwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdOYXZDdHJsJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6IGRlZmF1bHRDdHJsQXNcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAnJzoge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2xheW91dC9jb250ZW50VG1wbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0NvbnRlbnRDdHJsJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6IGRlZmF1bHRDdHJsQXNcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzaWRlYmFyOiB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvbGF5b3V0L3NpZGViYXJUbXBsJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnU2lkZWJhckN0cmwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogZGVmYXVsdEN0cmxBc1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZvb3Rlcjoge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2xheW91dC9mb290ZXJUbXBsJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRm9vdGVyQ3RybCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiBkZWZhdWx0Q3RybEFzXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC5zdGF0ZSgnYXBwJywge1xuICAgICAgICAgICAgICAgIGFic3RyYWN0OiB0cnVlLFxuICAgICAgICAgICAgICAgIHVybDogJy9hcHAnLFxuICAgICAgICAgICAgICAgIHZpZXdzOiBtYWluVmlld3NPYmpcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEFkZCBleHRyYSBwcm9wZXJ0aWVzIHRvIGVhY2ggc3RhdGUuXG4gICAgYXBwLnJ1bihbJyRyb290U2NvcGUnLCBmdW5jdGlvbiAoJHJvb3RTY29wZSkge1xuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uIChldmVudCwgY3VycmVudCkge1xuICAgICAgICAgICAgJHJvb3RTY29wZS50aXRsZSA9IGN1cnJlbnQudGl0bGU7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLmJvZHlDc3MgPSBjdXJyZW50LmJvZHlDc3M7XG4gICAgICAgIH0pO1xuICAgIH1dKTtcblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBhcHBBZG1pbiA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuYWRtaW4nKTtcblxuICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIENvbmZpZy5cbiAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBhcHBBZG1pbi5jb25maWcoQ29uZmlndXJhdGlvbik7XG5cbiAgICBDb25maWd1cmF0aW9uLiRpbmplY3QgPSBbJyRzdGF0ZVByb3ZpZGVyJ107XG5cbiAgICBmdW5jdGlvbiBDb25maWd1cmF0aW9uKCRzdGF0ZVByb3ZpZGVyKSB7XG4gICAgICAgIHZhciByb3V0ZVJvbGVDaGVja3MgPSB7XG4gICAgICAgICAgICBhZG1pbjoge1xuICAgICAgICAgICAgICAgIGF1dGg6IGZ1bmN0aW9uIChhdXRoU2VydmljZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXV0aFNlcnZpY2UuYXV0aG9yaXplQ3VycmVudFVzZXJGb3JSb3V0ZSgnYWRtaW4nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC5zdGF0ZSgnYXBwLnVzZXJMaXN0Jywge1xuICAgICAgICAgICAgICAgIHVybDogJy91c2VyLWxpc3QnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2NvbXBvbmVudHMvYWRtaW4vdXNlckxpc3RWaWV3JyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnVXNlckxpc3RDdHJsJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgcmVzb2x2ZTogcm91dGVSb2xlQ2hlY2tzLmFkbWluLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnVXNlciBMaXN0JyxcbiAgICAgICAgICAgICAgICBib2R5Q3NzOiAndXNlci1saXN0J1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gUnVuLlxuICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIGFwcEFkbWluLnJ1bihSdW4pO1xuXG4gICAgUnVuLiRpbmplY3QgPSBbJyRyb290U2NvcGUnLCAnJHN0YXRlJ107XG5cbiAgICBmdW5jdGlvbiBSdW4oJHJvb3RTY29wZSwgJHN0YXRlKSB7XG4gICAgICAgICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VFcnJvcicsIGZ1bmN0aW9uIChldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcywgZXJyb3IpIHtcbiAgICAgICAgICAgIGlmIChlcnJvci5ub3RBdXRob3JpemVkKSB7XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdhcHAuaG9tZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5ob21lJykuY29uZmlnKENvbmZpZ3VyYXRpb24pO1xuXG4gICAgQ29uZmlndXJhdGlvbi4kaW5qZWN0ID0gWyckc3RhdGVQcm92aWRlciddO1xuXG4gICAgZnVuY3Rpb24gQ29uZmlndXJhdGlvbigkc3RhdGVQcm92aWRlcikge1xuICAgICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAgICAgLnN0YXRlKCdhcHAuaG9tZScsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvaG9tZScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvY29tcG9uZW50cy9ob21lL2hvbWVWaWV3JyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnSG9tZUN0cmwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0hvbWUnLFxuICAgICAgICAgICAgICAgIGJvZHlDc3M6ICdob21lJ1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5wcm9maWxlJykuY29uZmlnKENvbmZpZ3VyYXRpb24pO1xuXG4gICAgQ29uZmlndXJhdGlvbi4kaW5qZWN0ID0gWyckc3RhdGVQcm92aWRlciddO1xuXG4gICAgZnVuY3Rpb24gQ29uZmlndXJhdGlvbigkc3RhdGVQcm92aWRlcikge1xuICAgICAgICB2YXIgcm91dGVSb2xlQ2hlY2tzID0ge1xuICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgIGF1dGg6IGZ1bmN0aW9uIChhdXRoU2VydmljZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXV0aFNlcnZpY2UuYXV0aG9yaXplQXV0aGVudGljYXRlZFVzZXJGb3JSb3V0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAgICAgLnN0YXRlKCdhcHAucHJvZmlsZScsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvcHJvZmlsZScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvY29tcG9uZW50cy9wcm9maWxlL3Byb2ZpbGVWaWV3JyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnUHJvZmlsZUN0cmwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICByZXNvbHZlOiByb3V0ZVJvbGVDaGVja3MudXNlcixcbiAgICAgICAgICAgICAgICB0aXRsZTogJ1Byb2ZpbGUnLFxuICAgICAgICAgICAgICAgIGJvZHlDc3M6ICdwcm9maWxlJ1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5yZWNpcGVzJykuY29uZmlnKENvbmZpZ3VyYXRpb24pO1xuXG4gICAgQ29uZmlndXJhdGlvbi4kaW5qZWN0ID0gWyckc3RhdGVQcm92aWRlciddO1xuXG4gICAgZnVuY3Rpb24gQ29uZmlndXJhdGlvbigkc3RhdGVQcm92aWRlcikge1xuICAgICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAgICAgLnN0YXRlKCdhcHAucmVjaXBlcycsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvcmVjaXBlcycsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvY29tcG9uZW50cy9yZWNpcGVzL3JlY2lwZXNWaWV3JyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnUmVjaXBlc0N0cmwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0aXRsZTogJ1JlY2lwZXMnLFxuICAgICAgICAgICAgICAgIGJvZHlDc3M6ICdyZWNpcGVzJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdGF0ZSgnYXBwLnJlY2lwZURldGFpbHMnLCB7XG4gICAgICAgICAgICAgICAgdXJsOiAnL3JlY2lwZS86aWQnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2NvbXBvbmVudHMvcmVjaXBlcy9yZWNpcGVEZXRhaWxzVmlldycsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1JlY2lwZURldGFpbHNDdHJsJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdSZWNpcGUgRGV0YWlscycsXG4gICAgICAgICAgICAgICAgYm9keUNzczogJ3JlY2lwZS1kZXRhaWxzJ1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGFwcFNpZ25VcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuc2lnblVwJyk7XG5cbiAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBDb25maWcuXG4gICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgYXBwU2lnblVwLmNvbmZpZyhDb25maWd1cmF0aW9uKTtcblxuICAgIENvbmZpZ3VyYXRpb24uJGluamVjdCA9IFsnJHN0YXRlUHJvdmlkZXInXTtcblxuICAgIGZ1bmN0aW9uIENvbmZpZ3VyYXRpb24oJHN0YXRlUHJvdmlkZXIpIHtcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC5zdGF0ZSgnYXBwLnNpZ25VcCcsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvc2lnbi11cCcsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvY29tcG9uZW50cy9zaWduVXAvc2lnblVwVmlldycsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1NpZ25VcEN0cmwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0aXRsZTogJ1NpZ24gVXAnLFxuICAgICAgICAgICAgICAgIGJvZHlDc3M6ICdzaWduLXVwJ1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5wcm92aWRlcnMnKS5jb25maWcoQ29uZmlndXJhdGlvbik7XG5cbiAgICBDb25maWd1cmF0aW9uLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIENvbmZpZ3VyYXRpb24oKSB7XG5cbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnJlc291cmNlcycpLmNvbmZpZyhDb25maWd1cmF0aW9uKTtcblxuICAgIENvbmZpZ3VyYXRpb24uJGluamVjdCA9IFtdO1xuXG4gICAgZnVuY3Rpb24gQ29uZmlndXJhdGlvbigpIHtcblxuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZXMnKS5jb25maWcoQ29uZmlndXJhdGlvbik7XG5cbiAgICBDb25maWd1cmF0aW9uLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIENvbmZpZ3VyYXRpb24oKSB7XG5cbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29udHJvbGxlcignQ29udGVudEN0cmwnLCBDb250ZW50Q3RybCk7XG5cbiAgICBDb250ZW50Q3RybC4kaW5qZWN0ID0gWydsb2dnZXInXTtcblxuICAgIGZ1bmN0aW9uIENvbnRlbnRDdHJsKGxvZ2dlcikge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIGluaXQoKTtcblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKENvbnRlbnRDdHJsLCBpbml0LCAnSW5pdGlhbGl6aW5nLi4uJyk7XG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29udHJvbGxlcignRm9vdGVyQ3RybCcsIEZvb3RlckN0cmwpO1xuXG4gICAgRm9vdGVyQ3RybC4kaW5qZWN0ID0gWydsb2dnZXInXTtcblxuICAgIGZ1bmN0aW9uIEZvb3RlckN0cmwobG9nZ2VyKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgaW5pdCgpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoRm9vdGVyQ3RybCwgaW5pdCwgJ0luaXRpYWxpemluZy4uLicpO1xuICAgICAgICB9XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnRyb2xsZXIoJ05hdkN0cmwnLCBOYXZDdHJsKTtcblxuICAgIE5hdkN0cmwuJGluamVjdCA9IFsnbG9nZ2VyJywgJyRodHRwJywgJyRzdGF0ZScsICdub3RpZmljYXRpb25Qcm92aWRlcicsICdpZGVudGl0eVNlcnZpY2UnLCAnYXV0aFNlcnZpY2UnXTtcblxuICAgIGZ1bmN0aW9uIE5hdkN0cmwobG9nZ2VyLCAkaHR0cCwgJHN0YXRlLCBub3RpZmljYXRpb25Qcm92aWRlciwgaWRlbnRpdHlTZXJ2aWNlLCBhdXRoU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEV4cG9zZSBmdW5jdGlvbnMuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIHZtLmxvZ0luID0gbG9nSW47XG4gICAgICAgIHZtLmxvZ091dCA9IGxvZ091dDtcblxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBJbml0aWFsaXphdGlvbi5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgaW5pdCgpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoTmF2Q3RybCwgaW5pdCwgJ0luaXRpYWxpemluZy4uLicpO1xuICAgICAgICAgICAgdm0uaWRlbnRpdHkgPSBpZGVudGl0eVNlcnZpY2U7XG4gICAgICAgIH1cblxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBFeHBvc2VkIGZ1bmN0aW9ucyBpbXBsZW1lbnRhdGlvbi5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgZnVuY3Rpb24gbG9nSW4oKSB7XG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoTmF2Q3RybCwgbG9nSW4sICdTaWduaW5nIGluLi4uJyk7XG5cbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0ZVVzZXIodm0udXNlcm5hbWUsIHZtLnBhc3N3b3JkKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25Qcm92aWRlci5zdWNjZXNzKCdZb3UgaGF2ZSBzdWNjZXNzZnVsbHkgbG9nZ2VkIGluLicpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uUHJvdmlkZXIuZXJyb3IoJ0ludmFsaWQgdXNlciBuYW1lIG9yIHBhc3N3b3JkIScpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBsb2dPdXQoKSB7XG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoTmF2Q3RybCwgbG9nT3V0LCAnU2lnbmluZyBpbi4uLicpO1xuXG4gICAgICAgICAgICBhdXRoU2VydmljZS5sb2dPdXRVc2VyKClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnVzZXJuYW1lID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIHZtLnBhc3N3b3JkID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblByb3ZpZGVyLmluZm8oJ1lvdSBoYXZlIGJlZW4gbG9nZ2VkIG91dC4nKTtcbiAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdhcHAuaG9tZScpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnRyb2xsZXIoJ1NpZGViYXJDdHJsJywgU2lkZWJhckN0cmwpO1xuXG4gICAgU2lkZWJhckN0cmwuJGluamVjdCA9IFsnbG9nZ2VyJ107XG5cbiAgICBmdW5jdGlvbiBTaWRlYmFyQ3RybChsb2dnZXIpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICBpbml0KCk7XG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhTaWRlYmFyQ3RybCwgaW5pdCwgJ0luaXRpYWxpemluZy4uLicpO1xuICAgICAgICAgICAgdm0udGVzdCA9ICd0ZXN0IHN0cmluZyc7XG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmFkbWluJykuY29udHJvbGxlcignVXNlckxpc3RDdHJsJywgVXNlckxpc3RDdHJsKTtcblxuICAgIFVzZXJMaXN0Q3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCAnbG9nZ2VyJywgJ1VzZXJSZXNvdXJjZSddO1xuXG4gICAgZnVuY3Rpb24gVXNlckxpc3RDdHJsKCRzY29wZSwgbG9nZ2VyLCBVc2VyUmVzb3VyY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICBpbml0KCk7XG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhVc2VyTGlzdEN0cmwsIGluaXQsICdJbml0aWFsaXppbmcuLi4nKTtcbiAgICAgICAgICAgIHZtLnVzZXJzID0gVXNlclJlc291cmNlLnF1ZXJ5KCk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5ob21lJykuY29udHJvbGxlcignSG9tZUN0cmwnLCBIb21lQ3RybCk7XG5cbiAgICBIb21lQ3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCAnbG9nZ2VyJ107XG5cbiAgICBmdW5jdGlvbiBIb21lQ3RybCgkc2NvcGUsIGxvZ2dlcikge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIGluaXQoKTtcblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKEhvbWVDdHJsLCBpbml0LCAnSW5pdGlhbGl6aW5nLi4uJyk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5wcm9maWxlJykuY29udHJvbGxlcignUHJvZmlsZUN0cmwnLCBQcm9maWxlQ3RybCk7XG5cbiAgICBQcm9maWxlQ3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCAnbG9nZ2VyJywgJ3ZhbGlkYXRpb24nLCAnYXV0aFNlcnZpY2UnLCAnaWRlbnRpdHlTZXJ2aWNlJywgJ25vdGlmaWNhdGlvblByb3ZpZGVyJ107XG5cbiAgICBmdW5jdGlvbiBQcm9maWxlQ3RybCgkc2NvcGUsIGxvZ2dlciwgdmFsaWRhdGlvbiwgYXV0aFNlcnZpY2UsIGlkZW50aXR5U2VydmljZSwgbm90aWZpY2F0aW9uUHJvdmlkZXIpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBFeHBvc2VkIGZ1bmN0aW9ucy5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgdm0uZ2V0Q2xhc3MgPSB2YWxpZGF0aW9uLmdldENsYXNzO1xuICAgICAgICB2bS51cGRhdGUgPSB1cGRhdGU7XG5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gSW5pdGlhbGl6YXRpb24uXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIGluaXQoKTtcblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKFByb2ZpbGVDdHJsLCBpbml0LCAnSW5pdGlhbGl6aW5nLi4uJyk7XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSB2aWV3LlxuICAgICAgICAgICAgdm0uZW1haWwgPSBpZGVudGl0eVNlcnZpY2UuY3VycmVudFVzZXIudXNlcm5hbWU7XG4gICAgICAgICAgICB2bS5maXJzdE5hbWUgPSBpZGVudGl0eVNlcnZpY2UuY3VycmVudFVzZXIuZmlyc3ROYW1lO1xuICAgICAgICAgICAgdm0ubGFzdE5hbWUgPSBpZGVudGl0eVNlcnZpY2UuY3VycmVudFVzZXIubGFzdE5hbWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBFeHBvc2VkIGZ1bmN0aW9ucyBpbXBsZW1lbnRhdGlvbi5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKFByb2ZpbGVDdHJsLCB1cGRhdGUsICdVcGRhdGluZyB1c2VyIHByb2ZpbGUuLi4nKTtcbiAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IHRydWU7XG5cbiAgICAgICAgICAgIHZhciBuZXdVc2VyRGF0YSA9IHtcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdm0uZW1haWwsXG4gICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB2bS5maXJzdE5hbWUsXG4gICAgICAgICAgICAgICAgbGFzdE5hbWU6IHZtLmxhc3ROYW1lXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAodm0ucGFzc3dvcmQgJiYgdm0ucGFzc3dvcmQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIG5ld1VzZXJEYXRhLnBhc3N3b3JkID0gdm0ucGFzc3dvcmQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLnVwZGF0ZUN1cnJlbnRVc2VyKG5ld1VzZXJEYXRhKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uUHJvdmlkZXIuc3VjY2VzcygnWW91ciB1c2VyIHByb2ZpbGUgaGFzIGJlZW4gdXBkYXRlZC4nKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblByb3ZpZGVyLmVycm9yKHJlYXNvbik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAucmVjaXBlcycpLmNvbnRyb2xsZXIoJ1JlY2lwZURldGFpbHNDdHJsJywgUmVjaXBlRGV0YWlsc0N0cmwpO1xuXG4gICAgUmVjaXBlRGV0YWlsc0N0cmwuJGluamVjdCA9IFsnJHNjb3BlJywgJyRodHRwJywgJ2xvZ2dlcicsICckc3RhdGVQYXJhbXMnLCAnUmVjaXBlUmVzb3VyY2UnLCAnaWRlbnRpdHlTZXJ2aWNlJywgJ25vdGlmaWNhdGlvblByb3ZpZGVyJ107XG5cbiAgICBmdW5jdGlvbiBSZWNpcGVEZXRhaWxzQ3RybCgkc2NvcGUsICRodHRwLCBsb2dnZXIsICRzdGF0ZVBhcmFtcywgUmVjaXBlUmVzb3VyY2UsIGlkZW50aXR5U2VydmljZSwgbm90aWZpY2F0aW9uUHJvdmlkZXIpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBFeHBvc2VkIGZ1bmN0aW9ucy5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgdm0uZ2V0SW5ncmVkaWVudERpc3BsYXkgPSBnZXRJbmdyZWRpZW50RGlzcGxheTtcbiAgICAgICAgdm0udG9nZ2xlU3RhciA9IHRvZ2dsZVN0YXI7XG4gICAgICAgIHZtLmlkZW50aXR5ID0gaWRlbnRpdHlTZXJ2aWNlO1xuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEluaXRpYWxpemF0aW9uLlxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICBpbml0KCk7XG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhSZWNpcGVEZXRhaWxzQ3RybCwgaW5pdCwgJ0luaXRpYWxpemluZy4uLicpO1xuXG4gICAgICAgICAgICBSZWNpcGVSZXNvdXJjZS5nZXQoeyBfaWQ6ICRzdGF0ZVBhcmFtcy5pZCB9LCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZSA9IGRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEV4cG9zZWQgZnVuY3Rpb25zIGltcGxlbWVudGF0aW9uLlxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICBmdW5jdGlvbiBnZXRJbmdyZWRpZW50RGlzcGxheShpbmdyZWRpZW50KSB7XG4gICAgICAgICAgICB2YXIgcXVhbnRpdHlTdHIgPSBpbmdyZWRpZW50LnF1YW50aXR5LnRyaW0oKTtcbiAgICAgICAgICAgIHZhciBuYW1lU3RyID0gaW5ncmVkaWVudC5uYW1lLnRyaW0oKTtcblxuICAgICAgICAgICAgaWYgKCFpc05hTihpbmdyZWRpZW50LnF1YW50aXR5KSkge1xuICAgICAgICAgICAgICAgIHF1YW50aXR5U3RyICs9ICcgeCAnO1xuICAgICAgICAgICAgICAgIGlmIChpbmdyZWRpZW50LnF1YW50aXR5ID4gMSkge1xuICAgICAgICAgICAgICAgICAgICBuYW1lU3RyICs9ICdzJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHF1YW50aXR5U3RyICs9ICcgb2YgJ1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcXVhbnRpdHlTdHIgKyBuYW1lU3RyO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlU3RhcigpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSAnL2FwaS9yZWNpcGVzLycgKyB2bS5yZWNpcGUuX2lkICsgJy90b2dnbGUtc3Rhcic7XG4gICAgICAgICAgICB2YXIgcHJvbWlzZSA9ICRodHRwLnB1dCh1cmwsIHsgc3RhcjogIXZtLnJlY2lwZS5pc1N0YXJyZWQoKSB9KTtcblxuICAgICAgICAgICAgcHJvbWlzZVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICB2bS5yZWNpcGUuc3RhcnJlZEJ5VXNlcnMgPSByZXNwb25zZS5kYXRhLnN0YXJyZWRCeVVzZXJzO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvclJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblByb3ZpZGVyLmVycm9yKCdGYWlsZWQgdG8gdXBkYXRlIHJlY2lwZS4nKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnJlY2lwZXMnKS5jb250cm9sbGVyKCdSZWNpcGVzQ3RybCcsIFJlY2lwZXNDdHJsKTtcblxuICAgIFJlY2lwZXNDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICdsb2dnZXInLCAnUmVjaXBlUmVzb3VyY2UnLCAnaWRlbnRpdHlTZXJ2aWNlJ107XG5cbiAgICBmdW5jdGlvbiBSZWNpcGVzQ3RybCgkc2NvcGUsIGxvZ2dlciwgUmVjaXBlUmVzb3VyY2UsIGlkZW50aXR5U2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIENvbnN0YW50cy5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgdm0ucGFnZU51bWJlciA9IDE7XG4gICAgICAgIHZtLnBhZ2VTaXplID0gMTA7XG4gICAgICAgIHZtLmRlYm91bmNlID0geyBkZWJvdW5jZTogMzAwIH07XG5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gRXhwb3NlZCBmdW5jdGlvbnMuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIHZtLmdldEZpbHRlcmVkID0gZ2V0RmlsdGVyZWQ7XG4gICAgICAgIHZtLnVwZGF0ZSA9IHVwZGF0ZTtcbiAgICAgICAgdm0uZ2V0TWFpbkluZ3JlZGllbnRzU3RyID0gZ2V0TWFpbkluZ3JlZGllbnRzU3RyO1xuICAgICAgICB2bS5pZGVudGl0eSA9IGlkZW50aXR5U2VydmljZTtcblxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBJbml0aWFsaXphdGlvbi5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgaW5pdCgpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoUmVjaXBlc0N0cmwsIGluaXQsICdJbml0aWFsaXppbmcuLi4nKTtcbiAgICAgICAgICAgIFJlY2lwZVJlc291cmNlLnF1ZXJ5KGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0ucmVjaXBlcyA9IF8uc29ydEJ5KGRhdGEsICduYW1lJyk7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEV4cG9zZWQgZnVuY3Rpb25zIGltcGxlbWVudGF0aW9uLlxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICBmdW5jdGlvbiBnZXRTdGFycmVkKCkge1xuICAgICAgICAgICAgaWYgKCFpZGVudGl0eVNlcnZpY2UuY3VycmVudFVzZXIpIHJldHVybiBbXTtcblxuICAgICAgICAgICAgcmV0dXJuIF8uZmlsdGVyKHZtLnJlY2lwZXMsIGZ1bmN0aW9uIChyZWNpcGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVjaXBlLnN0YXJyZWRCeVVzZXJzLmluZGV4T2YoaWRlbnRpdHlTZXJ2aWNlLmN1cnJlbnRVc2VyLl9pZCkgPj0gMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRGaWx0ZXJlZCgpIHtcbiAgICAgICAgICAgIHZhciBsb3dlckNhc2VTZWFyY2ggPSB2bS5zZWFyY2ggPyB2bS5zZWFyY2gudG9Mb3dlckNhc2UoKSA6IG51bGw7XG5cbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBfLmZpbHRlcih2bS5yZWNpcGVzLCBmdW5jdGlvbiAocmVjaXBlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlYXJjaFJlc3VsdCA9ICF2bS5zZWFyY2hcbiAgICAgICAgICAgICAgICAgICAgfHwgcmVjaXBlLm5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKGxvd2VyQ2FzZVNlYXJjaCkgPj0gMFxuICAgICAgICAgICAgICAgICAgICB8fCBfLmZpbHRlcihyZWNpcGUuaW5ncmVkaWVudHMsIGZ1bmN0aW9uIChpbmdyZWRpZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5ncmVkaWVudC5uYW1lLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihsb3dlckNhc2VTZWFyY2gpID49IDA7XG4gICAgICAgICAgICAgICAgICAgIH0pLmxlbmd0aCA+IDA7XG5cbiAgICAgICAgICAgICAgICB2YXIgbWF4VGltZVJlc3VsdCA9ICF2bS5tYXhUaW1lIHx8IHJlY2lwZS50aW1lIDw9IHZtLm1heFRpbWU7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3RhcnJlZFJlc3VsdCA9ICF2bS5zdGFycmVkIHx8IHJlY2lwZS5zdGFycmVkQnlVc2Vycy5pbmRleE9mKGlkZW50aXR5U2VydmljZS5jdXJyZW50VXNlci5faWQpID49IDA7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gc2VhcmNoUmVzdWx0ICYmIG1heFRpbWVSZXN1bHQgJiYgc3RhcnJlZFJlc3VsdDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgICAgICAgICAgdm0uc3RhcnJlZFJlY2lwZXMgPSBnZXRTdGFycmVkKCk7XG4gICAgICAgICAgICB2bS5maWx0ZXJlZFJlY2lwZXMgPSBnZXRGaWx0ZXJlZCgpO1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgcGFnZS5cbiAgICAgICAgICAgIHZtLnN0YXJ0SW5kZXggPSBNYXRoLm1heCgodm0ucGFnZU51bWJlciAtIDEpICogdm0ucGFnZVNpemUsIDApO1xuICAgICAgICAgICAgdm0uZW5kSW5kZXggPSBNYXRoLm1pbih2bS5wYWdlTnVtYmVyICogdm0ucGFnZVNpemUsIHZtLmZpbHRlcmVkUmVjaXBlcy5sZW5ndGgpO1xuICAgICAgICAgICAgdm0ucGFnZWRSZWNpcGVzID0gdm0uZmlsdGVyZWRSZWNpcGVzLnNsaWNlKHZtLnN0YXJ0SW5kZXgsIHZtLmVuZEluZGV4KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldE1haW5JbmdyZWRpZW50c1N0cihpbmdyZWRpZW50cykge1xuICAgICAgICAgICAgdmFyIG1haW5JbmdyZWRpZW50cyA9IF8uZmlsdGVyKGluZ3JlZGllbnRzLCBmdW5jdGlvbiAoaW5ncmVkaWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpbmdyZWRpZW50LmlzTWFpbjtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgbmFtZXMgPSBfLm1hcChtYWluSW5ncmVkaWVudHMsIGZ1bmN0aW9uIChpbmdyZWRpZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKCFpc05hTihpbmdyZWRpZW50LnF1YW50aXR5KSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5ncmVkaWVudC5uYW1lLnRyaW0oKSArICdzJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gaW5ncmVkaWVudC5uYW1lLnRyaW0oKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgam9pbmVkU3RyID0gbmFtZXMuam9pbignLCAnKTtcbiAgICAgICAgICAgIGlmIChqb2luZWRTdHIubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGpvaW5lZFN0ciA9IGpvaW5lZFN0clswXS50b1VwcGVyQ2FzZSgpICsgam9pbmVkU3RyLnNsaWNlKDEpO1xuICAgICAgICAgICAgICAgIGpvaW5lZFN0ciArPSAnLic7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBqb2luZWRTdHI7XG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zaWduVXAnKS5jb250cm9sbGVyKCdTaWduVXBDdHJsJywgU2lnblVwQ3RybCk7XG5cbiAgICBTaWduVXBDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckc3RhdGUnLCAnbG9nZ2VyJywgJ25vdGlmaWNhdGlvblByb3ZpZGVyJywgJ3ZhbGlkYXRpb24nLCAnYXV0aFNlcnZpY2UnXTtcblxuICAgIGZ1bmN0aW9uIFNpZ25VcEN0cmwoJHNjb3BlLCAkc3RhdGUsIGxvZ2dlciwgbm90aWZpY2F0aW9uUHJvdmlkZXIsIHZhbGlkYXRpb24sIGF1dGhTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gRXhwb3NlZCBmdW5jdGlvbnMuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIHZtLmdldENsYXNzID0gdmFsaWRhdGlvbi5nZXRDbGFzcztcbiAgICAgICAgdm0uc2lnblVwID0gc2lnblVwO1xuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEluaXRpYWxpemF0aW9uLlxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICBpbml0KCk7XG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhTaWduVXBDdHJsLCBpbml0LCAnSW5pdGlhbGl6aW5nLi4uJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBFeHBvc2VkIGZ1bmN0aW9ucyBpbXBsZW1lbnRhdGlvbi5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgZnVuY3Rpb24gc2lnblVwKCkge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKFNpZ25VcEN0cmwsIHNpZ25VcCwgJ1N1Ym1pdHRpbmcgZm9ybS4uLicpO1xuICAgICAgICAgICAgdm0uaXNMb2FkaW5nID0gdHJ1ZTtcblxuICAgICAgICAgICAgdmFyIG5ld1VzZXJEYXRhID0ge1xuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB2bS5lbWFpbCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogdm0ucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB2bS5maXJzdE5hbWUsXG4gICAgICAgICAgICAgICAgbGFzdE5hbWU6IHZtLmxhc3ROYW1lXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBhdXRoU2VydmljZS5jcmVhdGVVc2VyKG5ld1VzZXJEYXRhKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uUHJvdmlkZXIuc3VjY2VzcygnVXNlciBzdWNjZXNzZnVsbHkgY3JlYXRlZC4nKTtcbiAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdhcHAuaG9tZScpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvclJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblByb3ZpZGVyLmVycm9yKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnByb3ZpZGVycycpLmZhY3RvcnkoJ2xvZ2dlcicsIExvZ2dlcik7XG5cbiAgICBMb2dnZXIuJGluamVjdCA9IFsnJGxvZyddO1xuXG4gICAgZnVuY3Rpb24gTG9nZ2VyKCRsb2cpIHtcbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gRXhwb3NlZCBmdW5jdGlvbnMuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIGZ1bmN0aW9uIGRlYnVnKGN0cmwsIGZ1bmMsIG1zZykge1xuICAgICAgICAgICAgJGxvZy5kZWJ1ZyhidWlsZE1zZyhjdHJsLCBmdW5jLCBtc2cpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGVycm9yKGN0cmwsIGZ1bmMsIG1zZykge1xuICAgICAgICAgICAgJGxvZy5lcnJvcihidWlsZE1zZyhjdHJsLCBmdW5jLCBtc2cpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGluZm8oY3RybCwgZnVuYywgbXNnKSB7XG4gICAgICAgICAgICAkbG9nLmluZm8oYnVpbGRNc2coY3RybCwgZnVuYywgbXNnKSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBsb2coY3RybCwgZnVuYywgbXNnKSB7XG4gICAgICAgICAgICAkbG9nLmxvZyhidWlsZE1zZyhjdHJsLCBmdW5jLCBtc2cpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHdhcm4oY3RybCwgZnVuYywgbXNnKSB7XG4gICAgICAgICAgICAkbG9nLndhcm4oYnVpbGRNc2coY3RybCwgZnVuYywgbXNnKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBIZWxwZXIgZnVuY3Rpb25zLlxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICBmdW5jdGlvbiBidWlsZE1zZyhjdHJsLCBmdW5jLCBtc2cpIHtcbiAgICAgICAgICAgIHJldHVybiBjdHJsLm5hbWUgKyAnIC0+ICcgKyBmdW5jLm5hbWUgKyAnKCk6ICcgKyBtc2c7XG4gICAgICAgIH1cblxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBFeHBvc2UgZnVuY3Rpb25zLlxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZGVidWc6IGRlYnVnLFxuICAgICAgICAgICAgZXJyb3I6IGVycm9yLFxuICAgICAgICAgICAgaW5mbzogaW5mbyxcbiAgICAgICAgICAgIGxvZzogbG9nLFxuICAgICAgICAgICAgd2Fybjogd2FyblxuICAgICAgICB9O1xuICAgIH1cblxufSkoKTsiLCJcbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5wcm92aWRlcnMnKS52YWx1ZSgndG9hc3RyJywgdG9hc3RyKTtcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnByb3ZpZGVycycpLmZhY3RvcnkoJ25vdGlmaWNhdGlvblByb3ZpZGVyJywgTm90aWZpY2F0aW9uUHJvdmlkZXIpO1xuXG4gICAgTm90aWZpY2F0aW9uUHJvdmlkZXIuJGluamVjdCA9IFsndG9hc3RyJywgJ2xvZ2dlciddO1xuXG4gICAgZnVuY3Rpb24gTm90aWZpY2F0aW9uUHJvdmlkZXIodG9hc3RyLCBsb2dnZXIpIHtcbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gVG9hc3RyIG9wdGlvbnMuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIHRvYXN0ci5vcHRpb25zID0ge1xuICAgICAgICAgICAgY2xvc2VCdXR0b246IGZhbHNlLFxuICAgICAgICAgICAgZGVidWc6IGZhbHNlLFxuICAgICAgICAgICAgbmV3ZXN0T25Ub3A6IGZhbHNlLFxuICAgICAgICAgICAgcHJvZ3Jlc3NCYXI6IGZhbHNlLFxuICAgICAgICAgICAgcG9zaXRpb25DbGFzczogJ3RvYXN0LXRvcC1jZW50ZXInLFxuICAgICAgICAgICAgcHJldmVudER1cGxpY2F0ZXM6IGZhbHNlLFxuICAgICAgICAgICAgb25jbGljazogbnVsbCxcbiAgICAgICAgICAgIHNob3dEdXJhdGlvbjogNTAwLFxuICAgICAgICAgICAgaGlkZUR1cmF0aW9uOiAxMDAwLFxuICAgICAgICAgICAgdGltZU91dDogMjAwMCxcbiAgICAgICAgICAgIGV4dGVuZGVkVGltZU91dDogMTAwMCxcbiAgICAgICAgICAgIHNob3dFYXNpbmc6ICdzd2luZycsXG4gICAgICAgICAgICBoaWRlRWFzaW5nOiAnbGluZWFyJyxcbiAgICAgICAgICAgIHNob3dNZXRob2Q6ICdmYWRlSW4nLFxuICAgICAgICAgICAgaGlkZU1ldGhvZDogJ2ZhZGVPdXQnXG4gICAgICAgIH07XG5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gUHVibGljIGZ1bmN0aW9ucy5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgZnVuY3Rpb24gc3VjY2Vzcyhtc2cpIHtcbiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKG1zZyk7XG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoTm90aWZpY2F0aW9uUHJvdmlkZXIsIHN1Y2Nlc3MsIG1zZyk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpbmZvKG1zZykge1xuICAgICAgICAgICAgdG9hc3RyLmluZm8obXNnKTtcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhOb3RpZmljYXRpb25Qcm92aWRlciwgaW5mbywgbXNnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHdhcm5pbmcobXNnKSB7XG4gICAgICAgICAgICB0b2FzdHIud2FybmluZyhtc2cpO1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKE5vdGlmaWNhdGlvblByb3ZpZGVyLCB3YXJuaW5nLCBtc2cpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZXJyb3IobXNnKSB7XG4gICAgICAgICAgICB0b2FzdHIuZXJyb3IobXNnKTtcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhOb3RpZmljYXRpb25Qcm92aWRlciwgZXJyb3IsIG1zZyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBFeHBvc2UgZnVuY3Rpb25zLlxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2Vzczogc3VjY2VzcyxcbiAgICAgICAgICAgIGluZm86IGluZm8sXG4gICAgICAgICAgICB3YXJuaW5nOiB3YXJuaW5nLFxuICAgICAgICAgICAgZXJyb3I6IGVycm9yXG4gICAgICAgIH07XG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5wcm92aWRlcnMnKS5mYWN0b3J5KCd2YWxpZGF0aW9uJywgVmFsaWRhdGlvbik7XG5cbiAgICBWYWxpZGF0aW9uLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIFZhbGlkYXRpb24oKSB7XG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEV4cG9zZWQgZnVuY3Rpb25zLlxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICBmdW5jdGlvbiBoYXNFcnJvcihmb3JtLCBmb3JtRWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGZvcm0uJHN1Ym1pdHRlZCAmJiBmb3JtRWxlbWVudC4kaW52YWxpZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGhhc1dhcm4oZm9ybSwgZm9ybUVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiAhZm9ybS4kc3VibWl0dGVkICYmIGZvcm1FbGVtZW50LiRkaXJ0eSAmJiBmb3JtRWxlbWVudC4kaW52YWxpZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGhhc1N1Y2Nlc3MoZm9ybUVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBmb3JtRWxlbWVudC4kZGlydHkgJiYgIWZvcm1FbGVtZW50LiRpbnZhbGlkO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Q2xhc3MoZm9ybSwgZm9ybUVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgJ2hhcy1lcnJvcic6IGhhc0Vycm9yKGZvcm0sIGZvcm1FbGVtZW50KSxcbiAgICAgICAgICAgICAgICAnaGFzLXdhcm5pbmcnOiBoYXNXYXJuKGZvcm0sIGZvcm1FbGVtZW50KSxcbiAgICAgICAgICAgICAgICAnaGFzLXN1Y2Nlc3MnOiBoYXNTdWNjZXNzKGZvcm1FbGVtZW50KVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEV4cG9zZSBmdW5jdGlvbnMuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBoYXNFcnJvcjogaGFzRXJyb3IsXG4gICAgICAgICAgICBoYXNXYXJuOiBoYXNXYXJuLFxuICAgICAgICAgICAgaGFzU3VjY2VzczogaGFzU3VjY2VzcyxcbiAgICAgICAgICAgIGdldENsYXNzOiBnZXRDbGFzc1xuICAgICAgICB9O1xuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAucmVzb3VyY2VzJykuZmFjdG9yeSgnUmVjaXBlUmVzb3VyY2UnLCBSZWNpcGVSZXNvdXJjZSk7XG5cbiAgICBSZWNpcGVSZXNvdXJjZS4kaW5qZWN0ID0gWyckcmVzb3VyY2UnLCAnaWRlbnRpdHlTZXJ2aWNlJ107XG5cbiAgICBmdW5jdGlvbiBSZWNpcGVSZXNvdXJjZSgkcmVzb3VyY2UsIGlkZW50aXR5U2VydmljZSkge1xuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBSZXNvdXJjZS5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgdmFyIFJlY2lwZVJlcyA9ICRyZXNvdXJjZSgnL2FwaS9yZWNpcGVzLzpfaWQnLCB7IF9pZDogJ0BpZCcgfSwge1xuICAgICAgICAgICAgdXBkYXRlOiB7IG1ldGhvZDogJ1BVVCcsIGlzQXJyYXk6IGZhbHNlIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgUmVjaXBlUmVzLnByb3RvdHlwZS5pc1N0YXJyZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gaWRlbnRpdHlTZXJ2aWNlLmN1cnJlbnRVc2VyICYmIHRoaXMuc3RhcnJlZEJ5VXNlcnMuaW5kZXhPZihpZGVudGl0eVNlcnZpY2UuY3VycmVudFVzZXIuX2lkKSA+PSAwO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVSZXM7XG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5yZXNvdXJjZXMnKS5mYWN0b3J5KCdVc2VyUmVzb3VyY2UnLCBVc2VyUmVzb3VyY2UpO1xuXG4gICAgVXNlclJlc291cmNlLiRpbmplY3QgPSBbJyRyZXNvdXJjZSddO1xuXG4gICAgZnVuY3Rpb24gVXNlclJlc291cmNlKCRyZXNvdXJjZSkge1xuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBSZXNvdXJjZS5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgdmFyIFVzZXJSZXMgPSAkcmVzb3VyY2UoJy9hcGkvdXNlcnMvOmlkJywge19pZDogJ0BpZCd9LCB7XG4gICAgICAgICAgICB1cGRhdGU6IHsgbWV0aG9kOiAnUFVUJywgaXNBcnJheTogZmFsc2UgfVxuICAgICAgICB9KTtcblxuICAgICAgICBVc2VyUmVzLnByb3RvdHlwZS5pc0FkbWluID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucm9sZXMgJiYgdGhpcy5yb2xlcy5pbmRleE9mKCdhZG1pbicpID49IDA7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFVzZXJSZXM7XG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlcycpLmZhY3RvcnkoJ2F1dGhTZXJ2aWNlJywgQXV0aFNlcnZpY2UpO1xuXG4gICAgQXV0aFNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCAnbG9nZ2VyJywgJ2lkZW50aXR5U2VydmljZScsICdVc2VyUmVzb3VyY2UnXTtcblxuICAgIGZ1bmN0aW9uIEF1dGhTZXJ2aWNlKCRodHRwLCAkcSwgbG9nZ2VyLCBpZGVudGl0eVNlcnZpY2UsIFVzZXJSZXNvdXJjZSkge1xuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBWYXJpYWJsZXMuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIHZhciBub3RBdXRob3JpemVkT2JqID0geyBub3RBdXRob3JpemVkOiB0cnVlIH07XG5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gUHVibGljIGZ1bmN0aW9ucy5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgZnVuY3Rpb24gYXV0aGVudGljYXRlVXNlcih1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICRodHRwLnBvc3QoJy9sb2dpbicsIHtcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXIgPSBuZXcgVXNlclJlc291cmNlKCk7XG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHVzZXIsIHJlc3BvbnNlLmRhdGEudXNlcik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gU2F2ZSBjdXJyZW50IHVzZXIuXG4gICAgICAgICAgICAgICAgICAgIGlkZW50aXR5U2VydmljZS5jdXJyZW50VXNlciA9IHVzZXI7XG5cbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBsb2dPdXRVc2VyKCkge1xuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgJGh0dHAucG9zdCgnL2xvZ291dCcsIHsgbG9nT3V0OiB0cnVlIH0pXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZGVudGl0eVNlcnZpY2UuY3VycmVudFVzZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVXNlcihuZXdVc2VyRGF0YSkge1xuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgIHZhciBuZXdVc2VyID0gbmV3IFVzZXJSZXNvdXJjZShuZXdVc2VyRGF0YSk7XG5cbiAgICAgICAgICAgIG5ld1VzZXIuJHNhdmUoKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWRlbnRpdHlTZXJ2aWNlLmN1cnJlbnRVc2VyID0gbmV3VXNlcjtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvclJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnJvclJlc3BvbnNlLmRhdGEucmVhc29uKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVDdXJyZW50VXNlcihuZXdVc2VyRGF0YSkge1xuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgdmFyIGNsb25lID0gYW5ndWxhci5jb3B5KGlkZW50aXR5U2VydmljZS5jdXJyZW50VXNlcik7XG4gICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChjbG9uZSwgbmV3VXNlckRhdGEpO1xuXG4gICAgICAgICAgICBjbG9uZS4kdXBkYXRlKClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlkZW50aXR5U2VydmljZS5jdXJyZW50VXNlciA9IGNsb25lO1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yUmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycm9yUmVzcG9uc2UuZGF0YS5yZWFzb24pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGF1dGhvcml6ZUN1cnJlbnRVc2VyRm9yUm91dGUocm9sZSkge1xuICAgICAgICAgICAgaWYgKGlkZW50aXR5U2VydmljZS5pc0F1dGhvcml6ZWQocm9sZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChub3RBdXRob3JpemVkT2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGF1dGhvcml6ZUF1dGhlbnRpY2F0ZWRVc2VyRm9yUm91dGUoKSB7XG4gICAgICAgICAgICBpZiAoaWRlbnRpdHlTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3Qobm90QXV0aG9yaXplZE9iaik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBFeHBvc2UgZnVuY3Rpb25zLlxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYXV0aGVudGljYXRlVXNlcjogYXV0aGVudGljYXRlVXNlcixcbiAgICAgICAgICAgIGxvZ091dFVzZXI6IGxvZ091dFVzZXIsXG4gICAgICAgICAgICBjcmVhdGVVc2VyOiBjcmVhdGVVc2VyLFxuICAgICAgICAgICAgdXBkYXRlQ3VycmVudFVzZXI6IHVwZGF0ZUN1cnJlbnRVc2VyLFxuICAgICAgICAgICAgYXV0aG9yaXplQ3VycmVudFVzZXJGb3JSb3V0ZTogYXV0aG9yaXplQ3VycmVudFVzZXJGb3JSb3V0ZSxcbiAgICAgICAgICAgIGF1dGhvcml6ZUF1dGhlbnRpY2F0ZWRVc2VyRm9yUm91dGU6IGF1dGhvcml6ZUF1dGhlbnRpY2F0ZWRVc2VyRm9yUm91dGVcbiAgICAgICAgfTtcbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2VzJykuZmFjdG9yeSgnaWRlbnRpdHlTZXJ2aWNlJywgSWRlbnRpdHlTZXJ2aWNlKTtcblxuICAgIElkZW50aXR5U2VydmljZS4kaW5qZWN0ID0gWyckd2luZG93JywgJ2xvZ2dlcicsICdVc2VyUmVzb3VyY2UnXTtcblxuICAgIGZ1bmN0aW9uIElkZW50aXR5U2VydmljZSgkd2luZG93LCBsb2dnZXIsIFVzZXJSZXNvdXJjZSkge1xuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBIYW5kbGUgYm9vdHN0cmFwcGVkIGN1cnJlbnQgdXNlciBvYmplY3QuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIHZhciBjdXJyZW50VXNlciA9IG51bGw7XG5cbiAgICAgICAgaWYgKCEhJHdpbmRvdy5ib290c3RyYXBwZWRVc2VyT2JqZWN0KSB7XG4gICAgICAgICAgICBjdXJyZW50VXNlciA9IG5ldyBVc2VyUmVzb3VyY2UoKTtcbiAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGN1cnJlbnRVc2VyLCAkd2luZG93LmJvb3RzdHJhcHBlZFVzZXJPYmplY3QpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gUHVibGljIGZ1bmN0aW9ucy5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgZnVuY3Rpb24gaXNBdXRoZW50aWNhdGVkKCkge1xuICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5jdXJyZW50VXNlcjtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGlzQXV0aG9yaXplZChyb2xlKSB7XG4gICAgICAgICAgICByZXR1cm4gISF0aGlzLmN1cnJlbnRVc2VyICYmIHRoaXMuY3VycmVudFVzZXIucm9sZXMuaW5kZXhPZihyb2xlKSA+PSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gRXhwb3NlIGZ1bmN0aW9ucy5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGN1cnJlbnRVc2VyOiBjdXJyZW50VXNlcixcbiAgICAgICAgICAgIGlzQXV0aGVudGljYXRlZDogaXNBdXRoZW50aWNhdGVkLFxuICAgICAgICAgICAgaXNBdXRob3JpemVkOiBpc0F1dGhvcml6ZWRcbiAgICAgICAgfTtcbiAgICB9XG5cbn0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9