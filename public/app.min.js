(function () {
    'use strict';

    var app = angular.module('app', [
        // Predefined modules.
        'ui.bootstrap',
        'ui.router',
        'ngResource',
        'ngRoute',

        // App components.
        'app.home',
        'app.userList',

        // App shared.
        'app.providers',
        'app.services',
        'app.resources'
    ]);
})();
(function () {
    'use strict';

    angular.module('app.home', [

    ]);

})();
(function () {
    'use strict';

    angular.module('app.userList', [

    ]);

})();
(function () {
    'use strict';

    angular.module('app.providers', []);

})();
(function () {
    'use strict';

    angular.module('app.resources', []);

})();
(function () {
    'use strict';

    angular.module('app.services', []);

})();
(function () {
    'use strict';

    var app = angular.module('app');

    app.config(Configuration);

    Configuration.$inject = ['$logProvider', '$stateProvider', '$urlRouterProvider', '$locationProvider'];

    function Configuration($logProvider, $stateProvider, $urlRouterProvider, $locationProvider) {
        // Logging.
        $logProvider.debugEnabled(true);

        // HTML5 mode.
        $locationProvider.html5Mode({
            enabled: true,
            requireBase: false
        });

        // Always default to home page.
        $urlRouterProvider.otherwise('/app/home');

        // Routes.
        var defaultCtrlAs = 'vm';
        var mainViewsObj = {
            nav: {
                templateUrl: '/partials/layout/navTmpl',
                controller: 'NavCtrl',
                controllerAs: defaultCtrlAs
            },
            '': {
                templateUrl: '/partials/layout/contentTmpl',
                controller: 'ContentCtrl',
                controllerAs: defaultCtrlAs
            },
            sidebar: {
                templateUrl: '/partials/layout/sidebarTmpl',
                controller: 'SidebarCtrl',
                controllerAs: defaultCtrlAs
            },
            footer: {
                templateUrl: '/partials/layout/footerTmpl',
                controller: 'FooterCtrl',
                controllerAs: defaultCtrlAs
            }
        };

        $stateProvider
            .state('app', {
                abstract: true,
                url: '/app',
                views: mainViewsObj
            });
    }

    // Add extra properties to each state.
    app.run(['$rootScope', function ($rootScope) {
        $rootScope.$on('$stateChangeSuccess', function (event, current) {
            $rootScope.title = current.title;
            $rootScope.bodyCss = current.bodyCss;
        });
    }]);

})();
(function () {
    'use strict';

    angular.module('app.home').config(Configuration);

    Configuration.$inject = ['$stateProvider'];

    function Configuration($stateProvider) {
        $stateProvider
            .state('app.home', {
                url: '/home',
                templateUrl: '/partials/components/home/homeView',
                controller: 'HomeCtrl',
                controllerAs: 'vm',
                title: 'Home',
                bodyCss: 'home'
            });
    }

})();
(function () {
    'use strict';

    var appUserList = angular.module('app.userList');

    //=========================================================================
    // Config.
    //=========================================================================
    appUserList.config(Configuration);

    Configuration.$inject = ['$stateProvider'];

    function Configuration($stateProvider) {
        var routeRoleChecks = {
            admin: {
                auth: function (authService) {
                    return authService.authorizeCurrentUserForRoute('admin');
                }
            }
        };

        $stateProvider
            .state('app.userList', {
                url: '/user-list',
                templateUrl: '/partials/components/userList/userListView',
                controller: 'UserListCtrl',
                controllerAs: 'vm',
                resolve: routeRoleChecks.admin,
                title: 'User List',
                bodyCss: 'user-list'
            });
    }

    //=========================================================================
    // Run.
    //=========================================================================
    appUserList.run(Run);

    Run.$inject = ['$rootScope', '$state'];

    function Run($rootScope, $state) {
        $rootScope.$on('$stateChangeError', function (event, toState, toParams, fromState, fromParams, error) {
            if (error.notAuthorized) {
                $state.go('app.home');
            }
        });
    }
})();
(function () {
    'use strict';

    angular.module('app.providers').config(Configuration);

    Configuration.$inject = [];

    function Configuration() {

    }

})();
(function () {
    'use strict';

    angular.module('app.resources').config(Configuration);

    Configuration.$inject = [];

    function Configuration() {

    }

})();
(function () {
    'use strict';

    angular.module('app.services').config(Configuration);

    Configuration.$inject = [];

    function Configuration() {

    }

})();
(function () {
    'use strict';

    angular.module('app').controller('ContentCtrl', ContentCtrl);

    ContentCtrl.$inject = ['logger'];

    function ContentCtrl(logger) {
        var vm = this;

        init();

        function init() {
            logger.debug(ContentCtrl, init, 'Initializing...');
        }

    }
})();
(function () {
    'use strict';

    angular.module('app').controller('FooterCtrl', FooterCtrl);

    FooterCtrl.$inject = ['logger'];

    function FooterCtrl(logger) {
        var vm = this;

        init();

        function init() {
            logger.debug(FooterCtrl, init, 'Initializing...');
        }

    }
})();
(function () {
    'use strict';

    angular.module('app').controller('NavCtrl', NavCtrl);

    NavCtrl.$inject = ['logger', '$http', '$state', 'notificationProvider', 'identityService', 'authService'];

    function NavCtrl(logger, $http, $state, notificationProvider, identityService, authService) {
        var vm = this;

        //=====================================================================
        // Expose functions.
        //=====================================================================
        vm.logIn = logIn;
        vm.logOut = logOut;

        //=====================================================================
        // Initialization.
        //=====================================================================
        init();

        function init() {
            logger.debug(NavCtrl, init, 'Initializing...');
            vm.identity = identityService;
        }

        //=====================================================================
        // Exposed functions implementation.
        //=====================================================================
        function logIn() {
            logger.debug(NavCtrl, logIn, 'Signing in...');

            authService.authenticateUser(vm.username, vm.password)
                .then(function (success) {
                    if (success) {
                        notificationProvider.success('You have successfully logged in.');
                    } else {
                        notificationProvider.error('Invalid user name or password!');
                    }
                });
        }

        function logOut() {
            logger.debug(NavCtrl, logOut, 'Signing in...');

            authService.logOutUser()
                .then(function () {
                    vm.username = '';
                    vm.password = '';
                    notificationProvider.info('You have been logged out.');
                    $state.go('app.home');
                });
        }

    }
})();
(function () {
    'use strict';

    angular.module('app').controller('SidebarCtrl', SidebarCtrl);

    SidebarCtrl.$inject = ['logger'];

    function SidebarCtrl(logger) {
        var vm = this;

        init();

        function init() {
            logger.debug(SidebarCtrl, init, 'Initializing...');
            vm.test = 'Test Recipe';
        }

    }
})();
(function () {
    'use strict';

    angular.module('app.home').controller('HomeCtrl', HomeCtrl);

    HomeCtrl.$inject = ['$scope', 'logger'];

    function HomeCtrl($scope, logger) {
        var vm = this;

        init();

        function init() {
            logger.debug(HomeCtrl, init, 'Initializing...');
        }
    }
})();
(function () {
    'use strict';

    angular.module('app.userList').controller('UserListCtrl', UserListCtrl);

    UserListCtrl.$inject = ['$scope', 'logger', 'UserResource'];

    function UserListCtrl($scope, logger, UserResource) {
        var vm = this;

        init();

        function init() {
            logger.debug(UserListCtrl, init, 'Initializing...');
            vm.users = UserResource.query();
        }
    }
})();
(function () {
    'use strict';

    angular.module('app.providers').factory('logger', Logger);

    Logger.$inject = ['$log'];

    function Logger($log) {
        //=====================================================================
        // Exposed functions.
        //=====================================================================
        function debug(ctrl, func, msg) {
            $log.debug(buildMsg(ctrl, func, msg));
        }

        function error(ctrl, func, msg) {
            $log.error(buildMsg(ctrl, func, msg));
        }

        function info(ctrl, func, msg) {
            $log.info(buildMsg(ctrl, func, msg));
        }

        function log(ctrl, func, msg) {
            $log.log(buildMsg(ctrl, func, msg));
        }

        function warn(ctrl, func, msg) {
            $log.warn(buildMsg(ctrl, func, msg));
        }

        //=====================================================================
        // Helper functions.
        //=====================================================================
        function buildMsg(ctrl, func, msg) {
            return ctrl.name + ' -> ' + func.name + '(): ' + msg;
        }

        //=====================================================================
        // Expose functions.
        //=====================================================================
        return {
            debug: debug,
            error: error,
            info: info,
            log: log,
            warn: warn
        };
    }

})();

(function () {
    'use strict';

    angular.module('app.providers').value('toastr', toastr);
    angular.module('app.providers').factory('notificationProvider', NotificationProvider);

    NotificationProvider.$inject = ['toastr', 'logger'];

    function NotificationProvider(toastr, logger) {
        //=====================================================================
        // Toastr options.
        //=====================================================================
        toastr.options = {
            closeButton: false,
            debug: false,
            newestOnTop: false,
            progressBar: false,
            positionClass: 'toast-top-center',
            preventDuplicates: false,
            onclick: null,
            showDuration: 500,
            hideDuration: 1000,
            timeOut: 2000,
            extendedTimeOut: 1000,
            showEasing: 'swing',
            hideEasing: 'linear',
            showMethod: 'fadeIn',
            hideMethod: 'fadeOut'
        };

        //=====================================================================
        // Public functions.
        //=====================================================================
        function success(msg) {
            toastr.success(msg);
            logger.debug(NotificationProvider, success, msg);
        }

        function info(msg) {
            toastr.info(msg);
            logger.debug(NotificationProvider, info, msg);
        }

        function warning(msg) {
            toastr.warning(msg);
            logger.debug(NotificationProvider, warning, msg);
        }

        function error(msg) {
            toastr.error(msg);
            logger.debug(NotificationProvider, error, msg);
        }

        //=====================================================================
        // Expose functions.
        //=====================================================================
        return {
            success: success,
            info: info,
            warning: warning,
            error: error
        };
    }

})();
(function () {
    'use strict';

    angular.module('app.resources').factory('UserResource', UserResource);

    UserResource.$inject = ['$resource'];

    function UserResource($resource) {
        //=====================================================================
        // Resource.
        //=====================================================================
        var UserRes = $resource('/api/users/:id', {_id: '@id'});

        UserRes.prototype.isAdmin = function () {
            return this.roles && this.roles.indexOf('admin') >= 0;
        };

        return UserRes;
    }

})();
(function () {
    'use strict';

    angular.module('app.services').factory('authService', AuthService);

    AuthService.$inject = ['$http', '$q', 'logger', 'identityService', 'UserResource'];

    function AuthService($http, $q, logger, identityService, UserResource) {
        //=====================================================================
        // Expose functions.
        //=====================================================================
        return {
            authenticateUser: authenticateUser,
            logOutUser: logOutUser,
            authorizeCurrentUserForRoute: authorizeCurrentUserForRoute
        };

        //=====================================================================
        // Public functions.
        //=====================================================================
        function authenticateUser(username, password) {
            var deferred = $q.defer();

            $http.post('/login', {
                username: username,
                password: password
            }).then(function (response) {
                if (response.data.success) {
                    var user = new UserResource();
                    angular.extend(user, response.data.user);

                    // Save current user.
                    identityService.currentUser = user;

                    deferred.resolve(true);
                } else {
                    deferred.resolve(false);
                }
            });

            return deferred.promise;
        }

        function logOutUser() {
            var deferred = $q.defer();

            $http.post('/logout', { logOut: true })
                .then(function () {
                    identityService.currentUser = null;
                    deferred.resolve();
                });

            return deferred.promise;
        }

        function authorizeCurrentUserForRoute(role) {
            if (identityService.isAuthorized(role)) {
                return true;
            } else {
                return $q.reject({ notAuthorized: true });
            }
        }
    }

})();
(function () {
    'use strict';

    angular.module('app.services').factory('identityService', IdentityService);

    IdentityService.$inject = ['$window', 'logger', 'UserResource'];

    function IdentityService($window, logger, UserResource) {
        //=====================================================================
        // Handle bootstrapped current user object.
        //=====================================================================
        var currentUser = null;

        if (!!$window.bootstrappedUserObject) {
            currentUser = new UserResource();
            angular.extend(currentUser, $window.bootstrappedUserObject);
        }

        //=====================================================================
        // Public functions.
        //=====================================================================
        function isAuthenticated() {
            return !!this.currentUser;
        }

        function isAuthorized(role) {
            return !!this.currentUser && this.currentUser.roles.indexOf(role) >= 0;
        }

        //=====================================================================
        // Expose functions.
        //=====================================================================
        return {
            currentUser: currentUser,
            isAuthenticated: isAuthenticated,
            isAuthorized: isAuthorized
        };
    }

})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJjb21wb25lbnRzL2hvbWUvYXBwLmhvbWUubW9kdWxlLmpzIiwiY29tcG9uZW50cy91c2VyTGlzdC9hcHAudXNlckxpc3QubW9kdWxlLmpzIiwic2hhcmVkL3Byb3ZpZGVycy9hcHAucHJvdmlkZXJzLm1vZHVsZS5qcyIsInNoYXJlZC9yZXNvdXJjZXMvYXBwLnJlc291cmNlcy5tb2R1bGUuanMiLCJzaGFyZWQvc2VydmljZXMvYXBwLnNlcnZpY2VzLm1vZHVsZS5qcyIsImFwcC5jb25maWcuanMiLCJjb21wb25lbnRzL2hvbWUvYXBwLmhvbWUuY29uZmlnLmpzIiwiY29tcG9uZW50cy91c2VyTGlzdC9hcHAudXNlckxpc3QuY29uZmlnLmpzIiwic2hhcmVkL3Byb3ZpZGVycy9hcHAucHJvdmlkZXJzLmNvbmZpZy5qcyIsInNoYXJlZC9yZXNvdXJjZXMvYXBwLnJlc291cmNlcy5jb25maWcuanMiLCJzaGFyZWQvc2VydmljZXMvYXBwLnNlcnZpY2VzLmNvbmZpZy5qcyIsImxheW91dC9jb250ZW50Q3RybC5qcyIsImxheW91dC9mb290ZXJDdHJsLmpzIiwibGF5b3V0L25hdkN0cmwuanMiLCJsYXlvdXQvc2lkZWJhckN0cmwuanMiLCJjb21wb25lbnRzL2hvbWUvaG9tZUN0cmwuanMiLCJjb21wb25lbnRzL3VzZXJMaXN0L3VzZXJMaXN0Q3RybC5qcyIsInNoYXJlZC9wcm92aWRlcnMvbG9nZ2VyLmpzIiwic2hhcmVkL3Byb3ZpZGVycy9ub3RpZmljYXRpb25Qcm92aWRlci5qcyIsInNoYXJlZC9yZXNvdXJjZXMvdXNlclJlc291cmNlLmpzIiwic2hhcmVkL3NlcnZpY2VzL2F1dGhTZXJ2aWNlLmpzIiwic2hhcmVkL3NlcnZpY2VzL2lkZW50aXR5U2VydmljZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxJQUFBLE1BQUEsUUFBQSxPQUFBLE9BQUE7O1FBRUE7UUFDQTtRQUNB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QSxZQUFBLFFBQUE7UUFDQSxJQUFBLEtBQUE7O1FBRUE7O1FBRUEsU0FBQSxPQUFBO1lBQ0EsT0FBQSxNQUFBLGFBQUEsTUFBQTtZQUNBLEdBQUEsT0FBQTs7Ozs7QUNkQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxXQUFBLFlBQUE7O0lBRUEsU0FBQSxVQUFBLENBQUEsVUFBQTs7SUFFQSxTQUFBLFNBQUEsUUFBQSxRQUFBO1FBQ0EsSUFBQSxLQUFBOztRQUVBOztRQUVBLFNBQUEsT0FBQTtZQUNBLE9BQUEsTUFBQSxVQUFBLE1BQUE7Ozs7QUNiQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsZ0JBQUEsV0FBQSxnQkFBQTs7SUFFQSxhQUFBLFVBQUEsQ0FBQSxVQUFBLFVBQUE7O0lBRUEsU0FBQSxhQUFBLFFBQUEsUUFBQSxjQUFBO1FBQ0EsSUFBQSxLQUFBOztRQUVBOztRQUVBLFNBQUEsT0FBQTtZQUNBLE9BQUEsTUFBQSxjQUFBLE1BQUE7WUFDQSxHQUFBLFFBQUEsYUFBQTs7OztBQ2RBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxpQkFBQSxRQUFBLFVBQUE7O0lBRUEsT0FBQSxVQUFBLENBQUE7O0lBRUEsU0FBQSxPQUFBLE1BQUE7Ozs7UUFJQSxTQUFBLE1BQUEsTUFBQSxNQUFBLEtBQUE7WUFDQSxLQUFBLE1BQUEsU0FBQSxNQUFBLE1BQUE7OztRQUdBLFNBQUEsTUFBQSxNQUFBLE1BQUEsS0FBQTtZQUNBLEtBQUEsTUFBQSxTQUFBLE1BQUEsTUFBQTs7O1FBR0EsU0FBQSxLQUFBLE1BQUEsTUFBQSxLQUFBO1lBQ0EsS0FBQSxLQUFBLFNBQUEsTUFBQSxNQUFBOzs7UUFHQSxTQUFBLElBQUEsTUFBQSxNQUFBLEtBQUE7WUFDQSxLQUFBLElBQUEsU0FBQSxNQUFBLE1BQUE7OztRQUdBLFNBQUEsS0FBQSxNQUFBLE1BQUEsS0FBQTtZQUNBLEtBQUEsS0FBQSxTQUFBLE1BQUEsTUFBQTs7Ozs7O1FBTUEsU0FBQSxTQUFBLE1BQUEsTUFBQSxLQUFB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QUNBLGNBQUEsSUFBQTtZQUNBLFFBQUEsT0FBQSxhQUFBLFFBQUE7Ozs7OztRQU1BLFNBQUEsa0JBQUE7WUFDQSxPQUFBLENBQUEsQ0FBQSxLQUFBOzs7UUFHQSxTQUFBLGFBQUEsTUFBQTtZQUNBLE9BQUEsQ0FBQSxDQUFBLEtBQUEsZUFBQSxLQUFBLFlBQUEsTUFBQSxRQUFBLFNBQUE7Ozs7OztRQU1BLE9BQUE7WUFDQSxhQUFBO1lBQ0EsaUJBQUE7WUFDQSxjQUFBOzs7O0tBSUEiLCJmaWxlIjoicHVibGljL2FwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJywgW1xuICAgICAgICAvLyBQcmVkZWZpbmVkIG1vZHVsZXMuXG4gICAgICAgICd1aS5ib290c3RyYXAnLFxuICAgICAgICAndWkucm91dGVyJyxcbiAgICAgICAgJ25nUmVzb3VyY2UnLFxuICAgICAgICAnbmdSb3V0ZScsXG5cbiAgICAgICAgLy8gQXBwIGNvbXBvbmVudHMuXG4gICAgICAgICdhcHAuaG9tZScsXG4gICAgICAgICdhcHAudXNlckxpc3QnLFxuXG4gICAgICAgIC8vIEFwcCBzaGFyZWQuXG4gICAgICAgICdhcHAucHJvdmlkZXJzJyxcbiAgICAgICAgJ2FwcC5zZXJ2aWNlcycsXG4gICAgICAgICdhcHAucmVzb3VyY2VzJ1xuICAgIF0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuaG9tZScsIFtcblxuICAgIF0pO1xuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC51c2VyTGlzdCcsIFtcblxuICAgIF0pO1xuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5wcm92aWRlcnMnLCBbXSk7XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnJlc291cmNlcycsIFtdKTtcblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZXMnLCBbXSk7XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xuXG4gICAgYXBwLmNvbmZpZyhDb25maWd1cmF0aW9uKTtcblxuICAgIENvbmZpZ3VyYXRpb24uJGluamVjdCA9IFsnJGxvZ1Byb3ZpZGVyJywgJyRzdGF0ZVByb3ZpZGVyJywgJyR1cmxSb3V0ZXJQcm92aWRlcicsICckbG9jYXRpb25Qcm92aWRlciddO1xuXG4gICAgZnVuY3Rpb24gQ29uZmlndXJhdGlvbigkbG9nUHJvdmlkZXIsICRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XG4gICAgICAgIC8vIExvZ2dpbmcuXG4gICAgICAgICRsb2dQcm92aWRlci5kZWJ1Z0VuYWJsZWQodHJ1ZSk7XG5cbiAgICAgICAgLy8gSFRNTDUgbW9kZS5cbiAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHtcbiAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICByZXF1aXJlQmFzZTogZmFsc2VcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWx3YXlzIGRlZmF1bHQgdG8gaG9tZSBwYWdlLlxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvYXBwL2hvbWUnKTtcblxuICAgICAgICAvLyBSb3V0ZXMuXG4gICAgICAgIHZhciBkZWZhdWx0Q3RybEFzID0gJ3ZtJztcbiAgICAgICAgdmFyIG1haW5WaWV3c09iaiA9IHtcbiAgICAgICAgICAgIG5hdjoge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2xheW91dC9uYXZUbXBsJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTmF2Q3RybCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiBkZWZhdWx0Q3RybEFzXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJyc6IHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9sYXlvdXQvY29udGVudFRtcGwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDb250ZW50Q3RybCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiBkZWZhdWx0Q3RybEFzXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2lkZWJhcjoge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2xheW91dC9zaWRlYmFyVG1wbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1NpZGViYXJDdHJsJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6IGRlZmF1bHRDdHJsQXNcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmb290ZXI6IHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9sYXlvdXQvZm9vdGVyVG1wbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Zvb3RlckN0cmwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogZGVmYXVsdEN0cmxBc1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAuc3RhdGUoJ2FwcCcsIHtcbiAgICAgICAgICAgICAgICBhYnN0cmFjdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB1cmw6ICcvYXBwJyxcbiAgICAgICAgICAgICAgICB2aWV3czogbWFpblZpZXdzT2JqXG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBBZGQgZXh0cmEgcHJvcGVydGllcyB0byBlYWNoIHN0YXRlLlxuICAgIGFwcC5ydW4oWyckcm9vdFNjb3BlJywgZnVuY3Rpb24gKCRyb290U2NvcGUpIHtcbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbiAoZXZlbnQsIGN1cnJlbnQpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUudGl0bGUgPSBjdXJyZW50LnRpdGxlO1xuICAgICAgICAgICAgJHJvb3RTY29wZS5ib2R5Q3NzID0gY3VycmVudC5ib2R5Q3NzO1xuICAgICAgICB9KTtcbiAgICB9XSk7XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmhvbWUnKS5jb25maWcoQ29uZmlndXJhdGlvbik7XG5cbiAgICBDb25maWd1cmF0aW9uLiRpbmplY3QgPSBbJyRzdGF0ZVByb3ZpZGVyJ107XG5cbiAgICBmdW5jdGlvbiBDb25maWd1cmF0aW9uKCRzdGF0ZVByb3ZpZGVyKSB7XG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAuc3RhdGUoJ2FwcC5ob21lJywge1xuICAgICAgICAgICAgICAgIHVybDogJy9ob21lJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9jb21wb25lbnRzL2hvbWUvaG9tZVZpZXcnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ3RybCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnSG9tZScsXG4gICAgICAgICAgICAgICAgYm9keUNzczogJ2hvbWUnXG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgYXBwVXNlckxpc3QgPSBhbmd1bGFyLm1vZHVsZSgnYXBwLnVzZXJMaXN0Jyk7XG5cbiAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBDb25maWcuXG4gICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgYXBwVXNlckxpc3QuY29uZmlnKENvbmZpZ3VyYXRpb24pO1xuXG4gICAgQ29uZmlndXJhdGlvbi4kaW5qZWN0ID0gWyckc3RhdGVQcm92aWRlciddO1xuXG4gICAgZnVuY3Rpb24gQ29uZmlndXJhdGlvbigkc3RhdGVQcm92aWRlcikge1xuICAgICAgICB2YXIgcm91dGVSb2xlQ2hlY2tzID0ge1xuICAgICAgICAgICAgYWRtaW46IHtcbiAgICAgICAgICAgICAgICBhdXRoOiBmdW5jdGlvbiAoYXV0aFNlcnZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF1dGhTZXJ2aWNlLmF1dGhvcml6ZUN1cnJlbnRVc2VyRm9yUm91dGUoJ2FkbWluJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAuc3RhdGUoJ2FwcC51c2VyTGlzdCcsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvdXNlci1saXN0JyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9jb21wb25lbnRzL3VzZXJMaXN0L3VzZXJMaXN0VmlldycsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1VzZXJMaXN0Q3RybCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHJvdXRlUm9sZUNoZWNrcy5hZG1pbixcbiAgICAgICAgICAgICAgICB0aXRsZTogJ1VzZXIgTGlzdCcsXG4gICAgICAgICAgICAgICAgYm9keUNzczogJ3VzZXItbGlzdCdcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIFJ1bi5cbiAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBhcHBVc2VyTGlzdC5ydW4oUnVuKTtcblxuICAgIFJ1bi4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJywgJyRzdGF0ZSddO1xuXG4gICAgZnVuY3Rpb24gUnVuKCRyb290U2NvcGUsICRzdGF0ZSkge1xuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlRXJyb3InLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMsIGVycm9yKSB7XG4gICAgICAgICAgICBpZiAoZXJyb3Iubm90QXV0aG9yaXplZCkge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnYXBwLmhvbWUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAucHJvdmlkZXJzJykuY29uZmlnKENvbmZpZ3VyYXRpb24pO1xuXG4gICAgQ29uZmlndXJhdGlvbi4kaW5qZWN0ID0gW107XG5cbiAgICBmdW5jdGlvbiBDb25maWd1cmF0aW9uKCkge1xuXG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5yZXNvdXJjZXMnKS5jb25maWcoQ29uZmlndXJhdGlvbik7XG5cbiAgICBDb25maWd1cmF0aW9uLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIENvbmZpZ3VyYXRpb24oKSB7XG5cbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2VzJykuY29uZmlnKENvbmZpZ3VyYXRpb24pO1xuXG4gICAgQ29uZmlndXJhdGlvbi4kaW5qZWN0ID0gW107XG5cbiAgICBmdW5jdGlvbiBDb25maWd1cmF0aW9uKCkge1xuXG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnRyb2xsZXIoJ0NvbnRlbnRDdHJsJywgQ29udGVudEN0cmwpO1xuXG4gICAgQ29udGVudEN0cmwuJGluamVjdCA9IFsnbG9nZ2VyJ107XG5cbiAgICBmdW5jdGlvbiBDb250ZW50Q3RybChsb2dnZXIpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICBpbml0KCk7XG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhDb250ZW50Q3RybCwgaW5pdCwgJ0luaXRpYWxpemluZy4uLicpO1xuICAgICAgICB9XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnRyb2xsZXIoJ0Zvb3RlckN0cmwnLCBGb290ZXJDdHJsKTtcblxuICAgIEZvb3RlckN0cmwuJGluamVjdCA9IFsnbG9nZ2VyJ107XG5cbiAgICBmdW5jdGlvbiBGb290ZXJDdHJsKGxvZ2dlcikge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIGluaXQoKTtcblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKEZvb3RlckN0cmwsIGluaXQsICdJbml0aWFsaXppbmcuLi4nKTtcbiAgICAgICAgfVxuXG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdOYXZDdHJsJywgTmF2Q3RybCk7XG5cbiAgICBOYXZDdHJsLiRpbmplY3QgPSBbJ2xvZ2dlcicsICckaHR0cCcsICckc3RhdGUnLCAnbm90aWZpY2F0aW9uUHJvdmlkZXInLCAnaWRlbnRpdHlTZXJ2aWNlJywgJ2F1dGhTZXJ2aWNlJ107XG5cbiAgICBmdW5jdGlvbiBOYXZDdHJsKGxvZ2dlciwgJGh0dHAsICRzdGF0ZSwgbm90aWZpY2F0aW9uUHJvdmlkZXIsIGlkZW50aXR5U2VydmljZSwgYXV0aFNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBFeHBvc2UgZnVuY3Rpb25zLlxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICB2bS5sb2dJbiA9IGxvZ0luO1xuICAgICAgICB2bS5sb2dPdXQgPSBsb2dPdXQ7XG5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gSW5pdGlhbGl6YXRpb24uXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIGluaXQoKTtcblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKE5hdkN0cmwsIGluaXQsICdJbml0aWFsaXppbmcuLi4nKTtcbiAgICAgICAgICAgIHZtLmlkZW50aXR5ID0gaWRlbnRpdHlTZXJ2aWNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gRXhwb3NlZCBmdW5jdGlvbnMgaW1wbGVtZW50YXRpb24uXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIGZ1bmN0aW9uIGxvZ0luKCkge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKE5hdkN0cmwsIGxvZ0luLCAnU2lnbmluZyBpbi4uLicpO1xuXG4gICAgICAgICAgICBhdXRoU2VydmljZS5hdXRoZW50aWNhdGVVc2VyKHZtLnVzZXJuYW1lLCB2bS5wYXNzd29yZClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uUHJvdmlkZXIuc3VjY2VzcygnWW91IGhhdmUgc3VjY2Vzc2Z1bGx5IGxvZ2dlZCBpbi4nKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblByb3ZpZGVyLmVycm9yKCdJbnZhbGlkIHVzZXIgbmFtZSBvciBwYXNzd29yZCEnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbG9nT3V0KCkge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKE5hdkN0cmwsIGxvZ091dCwgJ1NpZ25pbmcgaW4uLi4nKTtcblxuICAgICAgICAgICAgYXV0aFNlcnZpY2UubG9nT3V0VXNlcigpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2bS51c2VybmFtZSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICB2bS5wYXNzd29yZCA9ICcnO1xuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25Qcm92aWRlci5pbmZvKCdZb3UgaGF2ZSBiZWVuIGxvZ2dlZCBvdXQuJyk7XG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnYXBwLmhvbWUnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdTaWRlYmFyQ3RybCcsIFNpZGViYXJDdHJsKTtcblxuICAgIFNpZGViYXJDdHJsLiRpbmplY3QgPSBbJ2xvZ2dlciddO1xuXG4gICAgZnVuY3Rpb24gU2lkZWJhckN0cmwobG9nZ2VyKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgaW5pdCgpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoU2lkZWJhckN0cmwsIGluaXQsICdJbml0aWFsaXppbmcuLi4nKTtcbiAgICAgICAgICAgIHZtLnRlc3QgPSAnVGVzdCBSZWNpcGUnO1xuICAgICAgICB9XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5ob21lJykuY29udHJvbGxlcignSG9tZUN0cmwnLCBIb21lQ3RybCk7XG5cbiAgICBIb21lQ3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCAnbG9nZ2VyJ107XG5cbiAgICBmdW5jdGlvbiBIb21lQ3RybCgkc2NvcGUsIGxvZ2dlcikge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIGluaXQoKTtcblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKEhvbWVDdHJsLCBpbml0LCAnSW5pdGlhbGl6aW5nLi4uJyk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC51c2VyTGlzdCcpLmNvbnRyb2xsZXIoJ1VzZXJMaXN0Q3RybCcsIFVzZXJMaXN0Q3RybCk7XG5cbiAgICBVc2VyTGlzdEN0cmwuJGluamVjdCA9IFsnJHNjb3BlJywgJ2xvZ2dlcicsICdVc2VyUmVzb3VyY2UnXTtcblxuICAgIGZ1bmN0aW9uIFVzZXJMaXN0Q3RybCgkc2NvcGUsIGxvZ2dlciwgVXNlclJlc291cmNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgaW5pdCgpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoVXNlckxpc3RDdHJsLCBpbml0LCAnSW5pdGlhbGl6aW5nLi4uJyk7XG4gICAgICAgICAgICB2bS51c2VycyA9IFVzZXJSZXNvdXJjZS5xdWVyeSgpO1xuICAgICAgICB9XG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAucHJvdmlkZXJzJykuZmFjdG9yeSgnbG9nZ2VyJywgTG9nZ2VyKTtcblxuICAgIExvZ2dlci4kaW5qZWN0ID0gWyckbG9nJ107XG5cbiAgICBmdW5jdGlvbiBMb2dnZXIoJGxvZykge1xuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBFeHBvc2VkIGZ1bmN0aW9ucy5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgZnVuY3Rpb24gZGVidWcoY3RybCwgZnVuYywgbXNnKSB7XG4gICAgICAgICAgICAkbG9nLmRlYnVnKGJ1aWxkTXNnKGN0cmwsIGZ1bmMsIG1zZykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZXJyb3IoY3RybCwgZnVuYywgbXNnKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKGJ1aWxkTXNnKGN0cmwsIGZ1bmMsIG1zZykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaW5mbyhjdHJsLCBmdW5jLCBtc2cpIHtcbiAgICAgICAgICAgICRsb2cuaW5mbyhidWlsZE1zZyhjdHJsLCBmdW5jLCBtc2cpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGxvZyhjdHJsLCBmdW5jLCBtc2cpIHtcbiAgICAgICAgICAgICRsb2cubG9nKGJ1aWxkTXNnKGN0cmwsIGZ1bmMsIG1zZykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gd2FybihjdHJsLCBmdW5jLCBtc2cpIHtcbiAgICAgICAgICAgICRsb2cud2FybihidWlsZE1zZyhjdHJsLCBmdW5jLCBtc2cpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEhlbHBlciBmdW5jdGlvbnMuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIGZ1bmN0aW9uIGJ1aWxkTXNnKGN0cmwsIGZ1bmMsIG1zZykge1xuICAgICAgICAgICAgcmV0dXJuIGN0cmwubmFtZSArICcgLT4gJyArIGZ1bmMubmFtZSArICcoKTogJyArIG1zZztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEV4cG9zZSBmdW5jdGlvbnMuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkZWJ1ZzogZGVidWcsXG4gICAgICAgICAgICBlcnJvcjogZXJyb3IsXG4gICAgICAgICAgICBpbmZvOiBpbmZvLFxuICAgICAgICAgICAgbG9nOiBsb2csXG4gICAgICAgICAgICB3YXJuOiB3YXJuXG4gICAgICAgIH07XG4gICAgfVxuXG59KSgpOyIsIlxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnByb3ZpZGVycycpLnZhbHVlKCd0b2FzdHInLCB0b2FzdHIpO1xuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAucHJvdmlkZXJzJykuZmFjdG9yeSgnbm90aWZpY2F0aW9uUHJvdmlkZXInLCBOb3RpZmljYXRpb25Qcm92aWRlcik7XG5cbiAgICBOb3RpZmljYXRpb25Qcm92aWRlci4kaW5qZWN0ID0gWyd0b2FzdHInLCAnbG9nZ2VyJ107XG5cbiAgICBmdW5jdGlvbiBOb3RpZmljYXRpb25Qcm92aWRlcih0b2FzdHIsIGxvZ2dlcikge1xuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBUb2FzdHIgb3B0aW9ucy5cbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgdG9hc3RyLm9wdGlvbnMgPSB7XG4gICAgICAgICAgICBjbG9zZUJ1dHRvbjogZmFsc2UsXG4gICAgICAgICAgICBkZWJ1ZzogZmFsc2UsXG4gICAgICAgICAgICBuZXdlc3RPblRvcDogZmFsc2UsXG4gICAgICAgICAgICBwcm9ncmVzc0JhcjogZmFsc2UsXG4gICAgICAgICAgICBwb3NpdGlvbkNsYXNzOiAndG9hc3QtdG9wLWNlbnRlcicsXG4gICAgICAgICAgICBwcmV2ZW50RHVwbGljYXRlczogZmFsc2UsXG4gICAgICAgICAgICBvbmNsaWNrOiBudWxsLFxuICAgICAgICAgICAgc2hvd0R1cmF0aW9uOiA1MDAsXG4gICAgICAgICAgICBoaWRlRHVyYXRpb246IDEwMDAsXG4gICAgICAgICAgICB0aW1lT3V0OiAyMDAwLFxuICAgICAgICAgICAgZXh0ZW5kZWRUaW1lT3V0OiAxMDAwLFxuICAgICAgICAgICAgc2hvd0Vhc2luZzogJ3N3aW5nJyxcbiAgICAgICAgICAgIGhpZGVFYXNpbmc6ICdsaW5lYXInLFxuICAgICAgICAgICAgc2hvd01ldGhvZDogJ2ZhZGVJbicsXG4gICAgICAgICAgICBoaWRlTWV0aG9kOiAnZmFkZU91dCdcbiAgICAgICAgfTtcblxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBQdWJsaWMgZnVuY3Rpb25zLlxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICBmdW5jdGlvbiBzdWNjZXNzKG1zZykge1xuICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MobXNnKTtcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhOb3RpZmljYXRpb25Qcm92aWRlciwgc3VjY2VzcywgbXNnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGluZm8obXNnKSB7XG4gICAgICAgICAgICB0b2FzdHIuaW5mbyhtc2cpO1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKE5vdGlmaWNhdGlvblByb3ZpZGVyLCBpbmZvLCBtc2cpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gd2FybmluZyhtc2cpIHtcbiAgICAgICAgICAgIHRvYXN0ci53YXJuaW5nKG1zZyk7XG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoTm90aWZpY2F0aW9uUHJvdmlkZXIsIHdhcm5pbmcsIG1zZyk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBlcnJvcihtc2cpIHtcbiAgICAgICAgICAgIHRvYXN0ci5lcnJvcihtc2cpO1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKE5vdGlmaWNhdGlvblByb3ZpZGVyLCBlcnJvciwgbXNnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEV4cG9zZSBmdW5jdGlvbnMuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiBzdWNjZXNzLFxuICAgICAgICAgICAgaW5mbzogaW5mbyxcbiAgICAgICAgICAgIHdhcm5pbmc6IHdhcm5pbmcsXG4gICAgICAgICAgICBlcnJvcjogZXJyb3JcbiAgICAgICAgfTtcbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnJlc291cmNlcycpLmZhY3RvcnkoJ1VzZXJSZXNvdXJjZScsIFVzZXJSZXNvdXJjZSk7XG5cbiAgICBVc2VyUmVzb3VyY2UuJGluamVjdCA9IFsnJHJlc291cmNlJ107XG5cbiAgICBmdW5jdGlvbiBVc2VyUmVzb3VyY2UoJHJlc291cmNlKSB7XG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIFJlc291cmNlLlxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICB2YXIgVXNlclJlcyA9ICRyZXNvdXJjZSgnL2FwaS91c2Vycy86aWQnLCB7X2lkOiAnQGlkJ30pO1xuXG4gICAgICAgIFVzZXJSZXMucHJvdG90eXBlLmlzQWRtaW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yb2xlcyAmJiB0aGlzLnJvbGVzLmluZGV4T2YoJ2FkbWluJykgPj0gMDtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gVXNlclJlcztcbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2VzJykuZmFjdG9yeSgnYXV0aFNlcnZpY2UnLCBBdXRoU2VydmljZSk7XG5cbiAgICBBdXRoU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdsb2dnZXInLCAnaWRlbnRpdHlTZXJ2aWNlJywgJ1VzZXJSZXNvdXJjZSddO1xuXG4gICAgZnVuY3Rpb24gQXV0aFNlcnZpY2UoJGh0dHAsICRxLCBsb2dnZXIsIGlkZW50aXR5U2VydmljZSwgVXNlclJlc291cmNlKSB7XG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEV4cG9zZSBmdW5jdGlvbnMuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhdXRoZW50aWNhdGVVc2VyOiBhdXRoZW50aWNhdGVVc2VyLFxuICAgICAgICAgICAgbG9nT3V0VXNlcjogbG9nT3V0VXNlcixcbiAgICAgICAgICAgIGF1dGhvcml6ZUN1cnJlbnRVc2VyRm9yUm91dGU6IGF1dGhvcml6ZUN1cnJlbnRVc2VyRm9yUm91dGVcbiAgICAgICAgfTtcblxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBQdWJsaWMgZnVuY3Rpb25zLlxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICBmdW5jdGlvbiBhdXRoZW50aWNhdGVVc2VyKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgJGh0dHAucG9zdCgnL2xvZ2luJywge1xuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdXNlciA9IG5ldyBVc2VyUmVzb3VyY2UoKTtcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQodXNlciwgcmVzcG9uc2UuZGF0YS51c2VyKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBTYXZlIGN1cnJlbnQgdXNlci5cbiAgICAgICAgICAgICAgICAgICAgaWRlbnRpdHlTZXJ2aWNlLmN1cnJlbnRVc2VyID0gdXNlcjtcblxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHRydWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGxvZ091dFVzZXIoKSB7XG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAkaHR0cC5wb3N0KCcvbG9nb3V0JywgeyBsb2dPdXQ6IHRydWUgfSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlkZW50aXR5U2VydmljZS5jdXJyZW50VXNlciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBhdXRob3JpemVDdXJyZW50VXNlckZvclJvdXRlKHJvbGUpIHtcbiAgICAgICAgICAgIGlmIChpZGVudGl0eVNlcnZpY2UuaXNBdXRob3JpemVkKHJvbGUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QoeyBub3RBdXRob3JpemVkOiB0cnVlIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlcycpLmZhY3RvcnkoJ2lkZW50aXR5U2VydmljZScsIElkZW50aXR5U2VydmljZSk7XG5cbiAgICBJZGVudGl0eVNlcnZpY2UuJGluamVjdCA9IFsnJHdpbmRvdycsICdsb2dnZXInLCAnVXNlclJlc291cmNlJ107XG5cbiAgICBmdW5jdGlvbiBJZGVudGl0eVNlcnZpY2UoJHdpbmRvdywgbG9nZ2VyLCBVc2VyUmVzb3VyY2UpIHtcbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gSGFuZGxlIGJvb3RzdHJhcHBlZCBjdXJyZW50IHVzZXIgb2JqZWN0LlxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICB2YXIgY3VycmVudFVzZXIgPSBudWxsO1xuXG4gICAgICAgIGlmICghISR3aW5kb3cuYm9vdHN0cmFwcGVkVXNlck9iamVjdCkge1xuICAgICAgICAgICAgY3VycmVudFVzZXIgPSBuZXcgVXNlclJlc291cmNlKCk7XG4gICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChjdXJyZW50VXNlciwgJHdpbmRvdy5ib290c3RyYXBwZWRVc2VyT2JqZWN0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIFB1YmxpYyBmdW5jdGlvbnMuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIGZ1bmN0aW9uIGlzQXV0aGVudGljYXRlZCgpIHtcbiAgICAgICAgICAgIHJldHVybiAhIXRoaXMuY3VycmVudFVzZXI7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpc0F1dGhvcml6ZWQocm9sZSkge1xuICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5jdXJyZW50VXNlciAmJiB0aGlzLmN1cnJlbnRVc2VyLnJvbGVzLmluZGV4T2Yocm9sZSkgPj0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEV4cG9zZSBmdW5jdGlvbnMuXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjdXJyZW50VXNlcjogY3VycmVudFVzZXIsXG4gICAgICAgICAgICBpc0F1dGhlbnRpY2F0ZWQ6IGlzQXV0aGVudGljYXRlZCxcbiAgICAgICAgICAgIGlzQXV0aG9yaXplZDogaXNBdXRob3JpemVkXG4gICAgICAgIH07XG4gICAgfVxuXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==